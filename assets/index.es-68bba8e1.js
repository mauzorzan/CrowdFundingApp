import{dl as mi,dm as Fv,dn as _r,dp as $v,dq as gh,dr as jv,ds as Mv,dt as zv,du as Lv,dv as Ps,aS as kv,dw as Ss,dx as $,aQ as bt,dy as Uv,dz as ki,dA as gi,dB as _t,dC as Rs,dD as ei,dE as Hv,dF as Bv,dG as Vv,dH as Ke,dI as tt,dJ as T,dK as Cs,dL as Kv,dM as yh,dN as Gv,dO as Wv,dP as mo,dQ as Qv,dR as Jv,dS as vs,dT as Yv,dU as mh,dV as Zv,dW as Xv,dX as ew,dY as vh,dZ as tw,d_ as iw,d$ as rw,e0 as vo,e1 as Ao,e2 as sw,e3 as br,e4 as wh,e5 as nw,e6 as ow,e7 as Oo,e8 as xs,e9 as aw,ea as Do,eb as wo,ec as Fe,ed as cw,ee as _h,ef as fi,eg as Y,eh as we,ei as To,ej as Xt,ek as Mt,el as Ve,em as hw,en as zt,eo as bu,ep as uw,eq as lw,er as pw,es as Eu,et as dw,eu as Iu,ev as Pu,ew as yi,ex as _o,ey as ws,ez as Ui,eA as fw,eB as gw,eC as yw,eD as mw,eE as _s,eF as vw,eG as eo,eH as ww,eI as bh,eJ as Eh,eK as Ih,eL as Ph,eM as Sh,eN as Rh,eO as _w,eP as dr,eQ as bw,eR as bo,eS as Ew,eT as to,eU as Ch,eV as Iw,eW as Pw,eX as Sw,eY as xh,eZ as Rw,e_ as Cw,e$ as xw,f0 as Aw,f1 as Ow,f2 as Dw,f3 as Tw,f4 as Fi,aL as qw,b0 as Nw,f5 as Ah,f6 as Fw,f7 as wr,f8 as Su,f9 as io,fa as Oh,c as $w}from"./index-7f608df4.js";const jw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:mi},Symbol.toStringTag,{value:"Module"})),Mw="idb-keyval";var zw=(u={})=>{const r=u.base&&u.base.length>0?`${u.base}:`:"",i=o=>r+o;let n;return u.dbName&&u.storeName&&(n=$v(u.dbName,u.storeName)),{name:Mw,options:u,async hasItem(o){return!(typeof await gh(i(o),n)>"u")},async getItem(o){return await gh(i(o),n)??null},setItem(o,c){return jv(i(o),c,n)},removeItem(o){return Mv(i(o),n)},getKeys(){return zv(n)},clear(){return Lv(n)}}};const Lw="WALLET_CONNECT_V2_INDEXED_DB",kw="keyvaluestorage";let Uw=class{constructor(){this.indexedDb=Fv({driver:zw({dbName:Lw,storeName:kw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(r=>[r.key,r.value])}async getItem(r){const i=await this.indexedDb.getItem(r);if(i!==null)return i}async setItem(r,i){await this.indexedDb.setItem(r,_r(i))}async removeItem(r){await this.indexedDb.removeItem(r)}};var ro=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bs={exports:{}};(function(){let u;function r(){}u=r,u.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},u.prototype.setItem=function(i,n){this[i]=String(n)},u.prototype.removeItem=function(i){delete this[i]},u.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},u.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},u.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ro<"u"&&ro.localStorage?bs.exports=ro.localStorage:typeof window<"u"&&window.localStorage?bs.exports=window.localStorage:bs.exports=new r})();function Hw(u){var r;return[u[0],Ps((r=u[1])!=null?r:"")]}let Bw=class{constructor(){this.localStorage=bs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Hw)}async getItem(r){const i=this.localStorage.getItem(r);if(i!==null)return Ps(i)}async setItem(r,i){this.localStorage.setItem(r,_r(i))}async removeItem(r){this.localStorage.removeItem(r)}};const Vw="wc_storage_version",Dh=1,Kw=async(u,r,i)=>{const n=Vw,o=await r.getItem(n);if(o&&o>=Dh){i(r);return}const c=await u.getKeys();if(!c.length){i(r);return}const l=[];for(;c.length;){const f=c.shift();if(!f)continue;const w=f.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const P=await u.getItem(f);await r.setItem(f,P),l.push(f)}}await r.setItem(n,Dh),i(r),Gw(u,l)},Gw=async(u,r)=>{r.length&&r.forEach(async i=>{await u.removeItem(i)})};let Ww=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const r=new Bw;this.storage=r;try{const i=new Uw;Kw(r,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(r){return await this.initialize(),this.storage.getItem(r)}async setItem(r,i){return await this.initialize(),this.storage.setItem(r,i)}async removeItem(r){return await this.initialize(),this.storage.removeItem(r)}async initialize(){this.initialized||await new Promise(r=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),r())},20)})}};var Hi={},fr={},so={},gr={};const Qw=kv(jw);var Th;function Jw(){if(Th)return gr;Th=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.IHeartBeat=void 0;const u=Qw;class r extends u.IEvents{constructor(n){super()}}return gr.IHeartBeat=r,gr}var qh;function Ru(){return qh||(qh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),Ss.__exportStar(Jw(),u)}(so)),so}var no={},di={},Nh;function Yw(){if(Nh)return di;Nh=1,Object.defineProperty(di,"__esModule",{value:!0}),di.HEARTBEAT_EVENTS=di.HEARTBEAT_INTERVAL=void 0;const u=$;return di.HEARTBEAT_INTERVAL=u.FIVE_SECONDS,di.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},di}var Fh;function Cu(){return Fh||(Fh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),Ss.__exportStar(Yw(),u)}(no)),no}var $h;function Zw(){if($h)return fr;$h=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.HeartBeat=void 0;const u=Ss,r=bt,i=$,n=Ru(),o=Cu();class c extends n.IHeartBeat{constructor(f){super(f),this.events=new r.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(f==null?void 0:f.interval)||o.HEARTBEAT_INTERVAL}static init(f){return u.__awaiter(this,void 0,void 0,function*(){const w=new c(f);return yield w.init(),w})}init(){return u.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(f,w){this.events.on(f,w)}once(f,w){this.events.once(f,w)}off(f,w){this.events.off(f,w)}removeListener(f,w){this.events.removeListener(f,w)}initialize(){return u.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return fr.HeartBeat=c,fr}(function(u){Object.defineProperty(u,"__esModule",{value:!0});const r=Ss;r.__exportStar(Zw(),u),r.__exportStar(Ru(),u),r.__exportStar(Cu(),u)})(Hi);class Xw extends mi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class e0 extends mi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class t0{constructor(r,i){this.logger=r,this.core=i}}let i0=class extends mi{constructor(r,i){super(),this.relayer=r,this.logger=i}},r0=class extends mi{constructor(r){super()}},s0=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}},n0=class extends mi{constructor(r,i){super(),this.relayer=r,this.logger=i}},o0=class extends mi{constructor(r,i){super(),this.core=r,this.logger=i}},a0=class{constructor(r,i){this.projectId=r,this.logger=i}},c0=class{constructor(r,i){this.projectId=r,this.logger=i}},h0=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},u0=class{constructor(r){this.client=r}};class Lt extends Uv{constructor(r){super(r),this.events=new bt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async request(r,i){return this.requestStrict(ki(r.method,r.params||[],r.id||gi().toString()),i)}async requestStrict(r,i){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${r.id}`,c=>{_t(c)?o(c.error):n(c.result)});try{await this.connection.send(r,i)}catch(c){o(c)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),Rs(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}function l0(u,r){if(u.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<u.length;o++){var c=u.charAt(o),l=c.charCodeAt(0);if(i[l]!==255)throw new TypeError(c+" is ambiguous");i[l]=o}var f=u.length,w=u.charAt(0),P=Math.log(f)/Math.log(256),A=Math.log(256)/Math.log(f);function x(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var M=0,V=0,W=0,se=D.length;W!==se&&D[W]===0;)W++,M++;for(var te=(se-W)*A+1>>>0,Z=new Uint8Array(te);W!==se;){for(var X=D[W],me=0,le=te-1;(X!==0||me<V)&&le!==-1;le--,me++)X+=256*Z[le]>>>0,Z[le]=X%f>>>0,X=X/f>>>0;if(X!==0)throw new Error("Non-zero carry");V=me,W++}for(var ue=te-V;ue!==te&&Z[ue]===0;)ue++;for(var Le=w.repeat(M);ue<te;++ue)Le+=u.charAt(Z[ue]);return Le}function F(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var M=0;if(D[M]!==" "){for(var V=0,W=0;D[M]===w;)V++,M++;for(var se=(D.length-M)*P+1>>>0,te=new Uint8Array(se);D[M];){var Z=i[D.charCodeAt(M)];if(Z===255)return;for(var X=0,me=se-1;(Z!==0||X<W)&&me!==-1;me--,X++)Z+=f*te[me]>>>0,te[me]=Z%256>>>0,Z=Z/256>>>0;if(Z!==0)throw new Error("Non-zero carry");W=X,M++}if(D[M]!==" "){for(var le=se-W;le!==se&&te[le]===0;)le++;for(var ue=new Uint8Array(V+(se-le)),Le=V;le!==se;)ue[Le++]=te[le++];return ue}}}function q(D){var M=F(D);if(M)return M;throw new Error(`Non-${r} character`)}return{encode:x,decodeUnsafe:F,decode:q}}var p0=l0,d0=p0;const xu=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},f0=u=>new TextEncoder().encode(u),g0=u=>new TextDecoder().decode(u);let y0=class{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}},m0=class{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Au(this,r)}},v0=class{constructor(r){this.decoders=r}or(r){return Au(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Au=(u,r)=>new v0({...u.decoders||{[u.prefix]:u},...r.decoders||{[r.prefix]:r}});let w0=class{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new y0(r,i,n),this.decoder=new m0(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}};const As=({name:u,prefix:r,encode:i,decode:n})=>new w0(u,r,i,n),Er=({prefix:u,name:r,alphabet:i})=>{const{encode:n,decode:o}=d0(i,r);return As({prefix:u,name:r,encode:n,decode:c=>xu(o(c))})},_0=(u,r,i,n)=>{const o={};for(let A=0;A<r.length;++A)o[r[A]]=A;let c=u.length;for(;u[c-1]==="=";)--c;const l=new Uint8Array(c*i/8|0);let f=0,w=0,P=0;for(let A=0;A<c;++A){const x=o[u[A]];if(x===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|x,f+=i,f>=8&&(f-=8,l[P++]=255&w>>f)}if(f>=i||255&w<<8-f)throw new SyntaxError("Unexpected end of data");return l},b0=(u,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let c="",l=0,f=0;for(let w=0;w<u.length;++w)for(f=f<<8|u[w],l+=8;l>i;)l-=i,c+=r[o&f>>l];if(l&&(c+=r[o&f<<i-l]),n)for(;c.length*i&7;)c+="=";return c},De=({name:u,prefix:r,bitsPerChar:i,alphabet:n})=>As({prefix:r,name:u,encode(o){return b0(o,n,i)},decode(o){return _0(o,n,i,u)}}),E0=As({prefix:"\0",name:"identity",encode:u=>g0(u),decode:u=>f0(u)});var I0=Object.freeze({__proto__:null,identity:E0});const P0=De({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var S0=Object.freeze({__proto__:null,base2:P0});const R0=De({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var C0=Object.freeze({__proto__:null,base8:R0});const x0=Er({prefix:"9",name:"base10",alphabet:"0123456789"});var A0=Object.freeze({__proto__:null,base10:x0});const O0=De({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),D0=De({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var T0=Object.freeze({__proto__:null,base16:O0,base16upper:D0});const q0=De({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),N0=De({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),F0=De({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$0=De({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),j0=De({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M0=De({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),z0=De({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),L0=De({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),k0=De({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var U0=Object.freeze({__proto__:null,base32:q0,base32upper:N0,base32pad:F0,base32padupper:$0,base32hex:j0,base32hexupper:M0,base32hexpad:z0,base32hexpadupper:L0,base32z:k0});const H0=Er({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),B0=Er({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var V0=Object.freeze({__proto__:null,base36:H0,base36upper:B0});const K0=Er({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G0=Er({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var W0=Object.freeze({__proto__:null,base58btc:K0,base58flickr:G0});const Q0=De({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),J0=De({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Y0=De({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Z0=De({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var X0=Object.freeze({__proto__:null,base64:Q0,base64pad:J0,base64url:Y0,base64urlpad:Z0});const Ou=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),e1=Ou.reduce((u,r,i)=>(u[i]=r,u),[]),t1=Ou.reduce((u,r,i)=>(u[r.codePointAt(0)]=i,u),[]);function i1(u){return u.reduce((r,i)=>(r+=e1[i],r),"")}function r1(u){const r=[];for(const i of u){const n=t1[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const s1=As({prefix:"🚀",name:"base256emoji",encode:i1,decode:r1});var n1=Object.freeze({__proto__:null,base256emoji:s1}),o1=Du,jh=128,a1=127,c1=~a1,h1=Math.pow(2,31);function Du(u,r,i){r=r||[],i=i||0;for(var n=i;u>=h1;)r[i++]=u&255|jh,u/=128;for(;u&c1;)r[i++]=u&255|jh,u>>>=7;return r[i]=u|0,Du.bytes=i-n+1,r}var u1=Eo,l1=128,Mh=127;function Eo(u,n){var i=0,n=n||0,o=0,c=n,l,f=u.length;do{if(c>=f)throw Eo.bytes=0,new RangeError("Could not decode varint");l=u[c++],i+=o<28?(l&Mh)<<o:(l&Mh)*Math.pow(2,o),o+=7}while(l>=l1);return Eo.bytes=c-n,i}var p1=Math.pow(2,7),d1=Math.pow(2,14),f1=Math.pow(2,21),g1=Math.pow(2,28),y1=Math.pow(2,35),m1=Math.pow(2,42),v1=Math.pow(2,49),w1=Math.pow(2,56),_1=Math.pow(2,63),b1=function(u){return u<p1?1:u<d1?2:u<f1?3:u<g1?4:u<y1?5:u<m1?6:u<v1?7:u<w1?8:u<_1?9:10},E1={encode:o1,decode:u1,encodingLength:b1},Tu=E1;const zh=(u,r,i=0)=>(Tu.encode(u,r,i),r),Lh=u=>Tu.encodingLength(u),Io=(u,r)=>{const i=r.byteLength,n=Lh(u),o=n+Lh(i),c=new Uint8Array(o+i);return zh(u,c,0),zh(i,c,n),c.set(r,o),new I1(u,i,r,c)};class I1{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const qu=({name:u,code:r,encode:i})=>new P1(u,r,i);let P1=class{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?Io(this.code,i):i.then(n=>Io(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Nu=u=>async r=>new Uint8Array(await crypto.subtle.digest(u,r)),S1=qu({name:"sha2-256",code:18,encode:Nu("SHA-256")}),R1=qu({name:"sha2-512",code:19,encode:Nu("SHA-512")});var C1=Object.freeze({__proto__:null,sha256:S1,sha512:R1});const Fu=0,x1="identity",$u=xu,A1=u=>Io(Fu,$u(u)),O1={code:Fu,name:x1,encode:$u,digest:A1};var D1=Object.freeze({__proto__:null,identity:O1});new TextEncoder,new TextDecoder;const kh={...I0,...S0,...C0,...A0,...T0,...U0,...V0,...W0,...X0,...n1};({...C1,...D1});function ju(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function T1(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ju(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function Mu(u,r,i,n){return{name:u,prefix:r,encoder:{name:u,prefix:r,encode:i},decoder:{decode:n}}}const Uh=Mu("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),oo=Mu("ascii","a",u=>{let r="a";for(let i=0;i<u.length;i++)r+=String.fromCharCode(u[i]);return r},u=>{u=u.substring(1);const r=T1(u.length);for(let i=0;i<u.length;i++)r[i]=u.charCodeAt(i);return r}),q1={utf8:Uh,"utf-8":Uh,hex:kh.base16,latin1:oo,ascii:oo,binary:oo,...kh};function N1(u,r="utf8"){const i=q1[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ju(globalThis.Buffer.from(u,"utf-8")):i.decoder.decode(`${i.prefix}${u}`)}const zu="wc",F1=2,qo="core",ti=`${zu}@2:${qo}:`,$1={name:qo,logger:"error"},j1={database:":memory:"},M1="crypto",Hh="client_ed25519_seed",z1=$.ONE_DAY,L1="keychain",k1="0.3",U1="messages",H1="0.3",B1=$.SIX_HOURS,V1="publisher",Lu="irn",K1="error",ku="wss://relay.walletconnect.com",Bh="wss://relay.walletconnect.org",G1="relayer",et={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},W1="_subscription",ut={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Q1=$.ONE_SECOND,J1="2.12.2",Y1=1e4,Z1="0.3",X1="WALLETCONNECT_CLIENT_ID",Rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},e_="subscription",t_="0.3",i_=$.FIVE_SECONDS*1e3,r_="pairing",s_="0.3",yr={wc_pairingDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:$.ONE_DAY,prompt:!1,tag:0},res:{ttl:$.ONE_DAY,prompt:!1,tag:0}}},zi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},n_="history",o_="0.3",a_="expirer",pt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},c_="0.3",ao="verify-api",Li="https://verify.walletconnect.com",Po="https://verify.walletconnect.org",h_=[Li,Po],u_="echo",l_="https://echo.walletconnect.com";class p_{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=L1,this.version=k1,this.initialized=!1,this.storagePrefix=ti,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:c}=T("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ke(i,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Iu(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Pu(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class d_{constructor(r,i,n){this.core=r,this.logger=i,this.name=M1,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=yh(o);return Gv(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=Wv();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),l=yh(c),f=mo();return await Qv(f,o,z1,l)},this.generateSharedKey=(o,c,l)=>{this.isInitialized();const f=this.getPrivateKey(o),w=Jv(f,c);return this.setSymKey(w,l)},this.setSymKey=async(o,c)=>{this.isInitialized();const l=c||vs(o);return await this.keychain.set(l,o),l},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,l)=>{this.isInitialized();const f=Yv(l),w=_r(c);if(mh(f)){const F=f.senderPublicKey,q=f.receiverPublicKey;o=await this.generateSharedKey(F,q)}const P=this.getSymKey(o),{type:A,senderPublicKey:x}=f;return Zv({type:A,symKey:P,message:w,senderPublicKey:x})},this.decode=async(o,c,l)=>{this.isInitialized();const f=Xv(c,l);if(mh(f)){const w=f.receiverPublicKey,P=f.senderPublicKey;o=await this.generateSharedKey(w,P)}try{const w=this.getSymKey(o),P=ew({symKey:w,encoded:c});return Ps(P)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const c=vh(o);return tw(c.type)},this.getPayloadSenderPublicKey=o=>{const c=vh(o);return c.senderPublicKey?iw(c.senderPublicKey,rw):void 0},this.core=r,this.logger=Ke(i,this.name),this.keychain=n||new p_(this.core,this.logger)}get context(){return tt(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Hh)}catch{r=mo(),await this.keychain.set(Hh,r)}return N1(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class f_ extends t0{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=U1,this.version=H1,this.initialized=!1,this.storagePrefix=ti,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const c=yi(o);let l=this.messages.get(n);return typeof l>"u"&&(l={}),typeof l[c]<"u"||(l[c]=o,this.messages.set(n,l),await this.persist()),c},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const c=this.get(n),l=yi(o);return typeof c[l]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ke(r,this.name),this.core=i}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Iu(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Pu(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class g_ extends i0{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new bt.EventEmitter,this.name=V1,this.queue=new Map,this.publishTimeout=$.toMiliseconds($.ONE_MINUTE),this.failedPublishTimeout=$.toMiliseconds($.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(n,o,c)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}});const f=(c==null?void 0:c.ttl)||B1,w=_o(c),P=(c==null?void 0:c.prompt)||!1,A=(c==null?void 0:c.tag)||0,x=(c==null?void 0:c.id)||gi().toString(),F={topic:n,message:o,opts:{ttl:f,relay:w,prompt:P,tag:A,id:x}},q=`Failed to publish payload, please try again. id:${x} tag:${A}`,D=Date.now();let M,V=1;try{for(;M===void 0;){if(Date.now()-D>this.publishTimeout)throw new Error(q);this.logger.trace({id:x,attempts:V},`publisher.publish - attempt ${V}`),M=await await br(this.rpcPublish(n,o,f,w,P,A,x).catch(W=>this.logger.warn(W)),this.publishTimeout,q),V++,M||await new Promise(W=>setTimeout(W,this.failedPublishTimeout))}this.relayer.events.emit(et.publish,F),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:x,topic:n,message:o,opts:c}})}catch(W){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(W),(l=c==null?void 0:c.internal)!=null&&l.throwOnFailedPublish)throw W;this.queue.set(x,F)}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Ke(i,this.name),this.registerEventListeners()}get context(){return tt(this.logger)}rpcPublish(r,i,n,o,c,l,f){var w,P,A,x;const F={method:ws(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:c,tag:l},id:f};return ei((w=F.params)==null?void 0:w.prompt)&&((P=F.params)==null||delete P.prompt),ei((A=F.params)==null?void 0:A.tag)&&((x=F.params)==null||delete x.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:F}),this.relayer.request(F)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(et.connection_stalled);return}this.checkQueue()}),this.relayer.on(et.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class y_{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(c=>c!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var m_=Object.defineProperty,v_=Object.defineProperties,w_=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,__=Object.prototype.hasOwnProperty,b_=Object.prototype.propertyIsEnumerable,Kh=(u,r,i)=>r in u?m_(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,mr=(u,r)=>{for(var i in r||(r={}))__.call(r,i)&&Kh(u,i,r[i]);if(Vh)for(var i of Vh(r))b_.call(r,i)&&Kh(u,i,r[i]);return u},co=(u,r)=>v_(u,w_(r));class E_ extends n0{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new y_,this.events=new bt.EventEmitter,this.name=e_,this.version=t_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ti,this.subscribeTimeout=$.toMiliseconds($.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const c=_o(o),l={topic:n,relay:c};this.pending.set(n,l);const f=await this.rpcSubscribe(n,c);return typeof f=="string"&&(this.onSubscribe(f,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}})),f}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>{if(this.topics.includes(n))return!0;const o=`${this.pendingSubscriptionWatchLabel}_${n}`;return await new Promise((c,l)=>{const f=new $.Watch;f.start(o);const w=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(w),f.stop(o),c(!0)),f.elapsed(o)>=i_&&(clearInterval(w),f.stop(o),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ke(i,this.name),this.clientId=""}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=_o(n);await this.rpcUnsubscribe(r,i,o);const c=we("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:ws(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await br(this.relayer.request(n).catch(o=>this.logger.warn(o)),this.subscribeTimeout)?yi(r+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(et.connection_stalled)}return null}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:ws(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await br(this.relayer.request(n).catch(o=>this.logger.warn(o)),this.subscribeTimeout)}catch{this.relayer.events.emit(et.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:ws(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,co(mr({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,mr({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i)}addSubscription(r,i){this.subscriptions.set(r,mr({},i)),this.topicMap.set(i.topic,r),this.events.emit(Rt.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Rt.deleted,co(mr({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Rt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Rt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);Ui(i)&&this.onBatchSubscribe(i.map((n,o)=>co(mr({},r[o]),{id:n})))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(Rt.created,async r=>{const i=Rt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Rt.deleted,async r=>{const i=Rt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var I_=Object.defineProperty,Gh=Object.getOwnPropertySymbols,P_=Object.prototype.hasOwnProperty,S_=Object.prototype.propertyIsEnumerable,Wh=(u,r,i)=>r in u?I_(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,R_=(u,r)=>{for(var i in r||(r={}))P_.call(r,i)&&Wh(u,i,r[i]);if(Gh)for(var i of Gh(r))S_.call(r,i)&&Wh(u,i,r[i]);return u};class C_ extends r0{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new bt.EventEmitter,this.name=G1,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=$.toMiliseconds($.THIRTY_SECONDS+$.ONE_SECOND),this.request=async i=>{var n,o;this.logger.debug("Publishing Request Payload");const c=i.id||gi().toString();await this.toEstablishConnection();try{const l=this.provider.request(i);this.requestsInFlight.set(c,{promise:l,request:i}),this.logger.trace({id:c,method:i.method,topic:(n=i.params)==null?void 0:n.topic},"relayer.request - attempt to publish...");const f=await new Promise(async(w,P)=>{const A=()=>{P(new Error(`relayer.request - publish interrupted, id: ${c}`))};this.provider.on(ut.disconnect,A);const x=await l;this.provider.off(ut.disconnect,A),w(x)});return this.logger.trace({id:c,method:i.method,topic:(o=i.params)==null?void 0:o.topic},"relayer.request - published"),f}catch(l){throw this.logger.debug(`Failed to Publish Request: ${c}`),l}finally{this.requestsInFlight.delete(c)}},this.resetPingTimeout=()=>{if(vo())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,n,o;(o=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||o.terminate()},this.heartBeatTimeout)}catch(i){this.logger.warn(i)}},this.onPayloadHandler=i=>{this.onProviderPayload(i),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(et.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(et.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ut.payload,this.onPayloadHandler),this.provider.on(ut.connect,this.onConnectHandler),this.provider.on(ut.disconnect,this.onDisconnectHandler),this.provider.on(ut.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ke(r.logger,this.name):Ao(Cs({level:r.logger||K1})),this.messages=new f_(this.logger,r.core),this.subscriber=new E_(this,this.logger),this.publisher=new g_(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||ku,this.projectId=r.projectId,this.bundleId=sw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Bh}...`),await this.restartTransport(Bh)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Y1)}get context(){return tt(this.logger)}get connected(){var r,i,n;return((n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:n.readyState)===1}get connecting(){var r,i,n;return((n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:n.readyState)===0}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"",c;const l=f=>{f.topic===r&&(this.subscriber.off(Rt.created,l),c())};return await Promise.all([new Promise(f=>{c=f,this.subscriber.on(Rt.created,l)}),new Promise(async f=>{o=await this.subscriber.subscribe(r,i)||o,f()})]),o}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(r=>r.promise))}catch(r){this.logger.warn(r)}this.hasExperiencedNetworkDisruption||this.connected?await br(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(r){await this.confirmOnlineStateOrThrow(),r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportDisconnect(),await this.createProvider()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(i,n)=>{const o=()=>{this.provider.off(ut.disconnect,o),n(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(ut.disconnect,o),await br(this.provider.connect(),$.toMiliseconds($.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(c=>{n(c)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i}finally{this.connectionAttemptInProgress=!1}}async restartTransport(r){this.connectionAttemptInProgress||(this.relayUrl=r||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await wh())throw new Error("No internet connection detected. Please restart your network and try again.")}startPingTimeout(){var r,i,n,o,c;if(vo())try{(i=(r=this.provider)==null?void 0:r.connection)!=null&&i.socket&&((c=(o=(n=this.provider)==null?void 0:n.connection)==null?void 0:o.socket)==null||c.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(l){this.logger.warn(l)}}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Lt(new nw(ow({sdkVersion:J1,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Oo(r)){if(!r.method.endsWith(W1))return;const i=r.params,{topic:n,message:o,publishedAt:c}=i.data,l={topic:n,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(R_({type:"event",event:i.id},l)),this.events.emit(i.id,l),await this.acknowledgePayload(r),await this.onMessageEvent(l)}else Rs(r)&&this.events.emit(et.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(et.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=xs(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(ut.payload,this.onPayloadHandler),this.provider.off(ut.connect,this.onConnectHandler),this.provider.off(ut.disconnect,this.onDisconnectHandler),this.provider.off(ut.error,this.onProviderErrorHandler)}async registerEventListeners(){let r=await wh();aw(async i=>{r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.events.emit(et.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(r=>this.logger.error(r))},$.toMiliseconds(Q1))}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var x_=Object.defineProperty,Qh=Object.getOwnPropertySymbols,A_=Object.prototype.hasOwnProperty,O_=Object.prototype.propertyIsEnumerable,Jh=(u,r,i)=>r in u?x_(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,Yh=(u,r)=>{for(var i in r||(r={}))A_.call(r,i)&&Jh(u,i,r[i]);if(Qh)for(var i of Qh(r))O_.call(r,i)&&Jh(u,i,r[i]);return u};class vi extends s0{constructor(r,i,n,o=ti,c=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=Z1,this.cached=[],this.initialized=!1,this.storagePrefix=ti,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!ei(l)?this.map.set(this.getKey(l),l):Hv(l)?this.map.set(l.id,l):Bv(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,f)=>{this.isInitialized(),this.map.has(l)?await this.update(l,f):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:f}),this.map.set(l,f),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(f=>Object.keys(l).every(w=>Vv(f[w],l[w]))):this.values),this.update=async(l,f)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:f});const w=Yh(Yh({},this.getData(l)),f);this.map.set(l,w),await this.persist()},this.delete=async(l,f)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:f}),this.map.delete(l),this.addToRecentlyDeleted(l),await this.persist())},this.logger=Ke(i,this.name),this.storagePrefix=o,this.getKey=c}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(r){this.recentlyDeleted.push(r),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){if(this.recentlyDeleted.includes(r)){const{message:o}=T("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${r}`);throw this.logger.error(o),new Error(o)}const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class D_{constructor(r,i){this.core=r,this.logger=i,this.name=r_,this.version=s_,this.events=new Do,this.initialized=!1,this.storagePrefix=ti,this.ignoredPayloadTypes=[wo],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async n=>{this.isInitialized();const o=mo(),c=await this.core.crypto.setSymKey(o),l=Fe($.FIVE_MINUTES),f={protocol:Lu},w={topic:c,expiry:l,relay:f,active:!1},P=cw({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:o,relay:f,expiryTimestamp:l,methods:n==null?void 0:n.methods});return await this.pairings.set(c,w),await this.core.relayer.subscribe(c),this.core.expirer.set(c,l),{topic:c,uri:P}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:c,relay:l,expiryTimestamp:f,methods:w}=_h(n.uri);let P;if(this.pairings.keys.includes(o)&&(P=this.pairings.get(o),P.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const A=f||Fe($.FIVE_MINUTES),x={topic:o,relay:l,expiry:A,active:!1,methods:w};return await this.pairings.set(o,x),this.core.expirer.set(o,A),n.activatePairing&&await this.activate({topic:o}),this.events.emit(zi.create,x),this.core.crypto.keychain.has(o)||await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:l}),x},this.activate=async({topic:n})=>{this.isInitialized();const o=Fe($.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:l,resolve:f,reject:w}=fi();this.events.once(Y("pairing_ping",c),({error:P})=>{P?w(P):f()}),await l()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",we("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,c)=>{const l=ki(o,c),f=await this.core.crypto.encode(n,l),w=yr[o].req;return this.core.history.set(n,l),this.core.relayer.publish(n,f,w),l.id},this.sendResult=async(n,o,c)=>{const l=xs(n,c),f=await this.core.crypto.encode(o,l),w=await this.core.history.get(o,n),P=yr[w.request.method].res;await this.core.relayer.publish(o,f,P),await this.core.history.resolve(l)},this.sendError=async(n,o,c)=>{const l=To(n,c),f=await this.core.crypto.encode(o,l),w=await this.core.history.get(o,n),P=yr[w.request.method]?yr[w.request.method].res:yr.unregistered_method.res;await this.core.relayer.publish(o,f,P),await this.core.history.resolve(l)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,we("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Xt(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:c}=n,l=(await this.core.history.get(o,c.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(n,o)=>{const{id:c}=o;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(zi.ping,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onPairingPingResponse=(n,o)=>{const{id:c}=o;setTimeout(()=>{Mt(o)?this.events.emit(Y("pairing_ping",c),{}):_t(o)&&this.events.emit(Y("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(zi.delete,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:c,method:l}=o;try{if(this.registeredMethods.includes(l))return;const f=we("WC_METHOD_UNSUPPORTED",l);await this.sendError(c,n,f),this.logger.error(f)}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(we("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Ve(n)){const{message:l}=T("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(l)}if(!hw(n.uri)){const{message:l}=T("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(l)}const c=_h(n.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:l}=T("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(c!=null&&c.symKey)){const{message:l}=T("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}if(c!=null&&c.expiryTimestamp&&$.toMiliseconds(c==null?void 0:c.expiryTimestamp)<Date.now()){const{message:l}=T("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(l)}},this.isValidPing=async n=>{if(!Ve(n)){const{message:c}=T("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ve(n)){const{message:c}=T("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!zt(n,!1)){const{message:o}=T("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=T("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Xt(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=T("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Ke(i,this.name),this.pairings=new vi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return tt(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(et.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{Oo(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):Rs(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(pt.expired,async r=>{const{topic:i}=bu(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(zi.expire,{topic:i}))})}}class T_ extends e0{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new bt.EventEmitter,this.name=n_,this.version=o_,this.cached=[],this.initialized=!1,this.storagePrefix=ti,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:c}),this.records.has(o.id))return;const l={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:c,expiry:Fe($.THIRTY_DAYS)};this.records.set(l.id,l),this.persist(),this.events.emit(wt.created,l)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=_t(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.persist(),this.events.emit(wt.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===n){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(wt.deleted,c)}}),this.persist()},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ke(i,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:ki(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(wt.created,r=>{const i=wt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r})}),this.events.on(wt.updated,r=>{const i=wt.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r})}),this.events.on(wt.deleted,r=>{const i=wt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r})}),this.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let r=!1;this.records.forEach(i=>{$.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.records.delete(i.id),this.events.emit(wt.deleted,i,!1),r=!0)}),r&&this.persist()}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class q_ extends o0{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new bt.EventEmitter,this.name=a_,this.version=c_,this.cached=[],this.initialized=!1,this.storagePrefix=ti,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const c=this.formatTarget(n),l={target:c,expiry:o};this.expirations.set(c,l),this.checkExpiry(c,l),this.events.emit(pt.created,{target:c,expiration:l})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(pt.deleted,{target:o,expiration:c})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ke(i,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return uw(r);if(typeof r=="number")return lw(r);const{message:i}=T("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pt.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.warn(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;$.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(pt.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pt.created,r=>{const i=pt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(pt.expired,r=>{const i=pt.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(pt.deleted,r=>{const i=pt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}let N_=class extends a0{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=ao,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||pw()||!Eu())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Po;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let c;try{c=await this.fetchAttestation(n.attestationId,o)}catch(l){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(l),c=await this.fetchAttestation(n.attestationId,Po)}return c},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const c=this.startAbortTimer($.ONE_SECOND*2),l=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),l.status===200?await l.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=c=>{c.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(c=>{const l=document.getElementById(ao);if(l)return this.iframe=l,this.onInit(),c();window.addEventListener("message",o);const f=document.createElement("iframe");f.id=ao,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=c}),new Promise((c,l)=>setTimeout(()=>{window.removeEventListener("message",o),l("verify iframe load timeout")},$.toMiliseconds($.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||Li;return h_.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${Li}`),o=Li),o},this.logger=Ke(i,this.name),this.verifyUrl=Li,this.abortController=new AbortController,this.isDevEnv=vo()&&{}.IS_VITEST}get context(){return tt(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),$.toMiliseconds(r))}},F_=class extends c0{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.context=u_,this.registerDeviceToken=async n=>{const{clientId:o,token:c,notificationType:l,enableEncrypted:f=!1}=n,w=`${l_}/${this.projectId}/clients`;await dw(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:l,token:c,always_raw:f})})},this.logger=Ke(i,this.context)}};var $_=Object.defineProperty,Zh=Object.getOwnPropertySymbols,j_=Object.prototype.hasOwnProperty,M_=Object.prototype.propertyIsEnumerable,Xh=(u,r,i)=>r in u?$_(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,eu=(u,r)=>{for(var i in r||(r={}))j_.call(r,i)&&Xh(u,i,r[i]);if(Zh)for(var i of Zh(r))M_.call(r,i)&&Xh(u,i,r[i]);return u};let z_=class Uu extends Xw{constructor(r){var i;super(r),this.protocol=zu,this.version=F1,this.name=qo,this.events=new bt.EventEmitter,this.initialized=!1,this.on=(l,f)=>this.events.on(l,f),this.once=(l,f)=>this.events.once(l,f),this.off=(l,f)=>this.events.off(l,f),this.removeListener=(l,f)=>this.events.removeListener(l,f),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||ku,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const n=Cs({level:typeof(r==null?void 0:r.logger)=="string"&&r.logger?r.logger:$1.logger}),{logger:o,chunkLoggerController:c}=Kv({opts:n,maxSizeInBytes:r==null?void 0:r.maxLogBlobSizeInBytes,loggerOverride:r==null?void 0:r.logger});this.logChunkController=c,(i=this.logChunkController)!=null&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var l,f;(l=this.logChunkController)!=null&&l.downloadLogsBlobInBrowser&&((f=this.logChunkController)==null||f.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ke(o,this.name),this.heartbeat=new Hi.HeartBeat,this.crypto=new d_(this,this.logger,r==null?void 0:r.keychain),this.history=new T_(this,this.logger),this.expirer=new q_(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new Ww(eu(eu({},j1),r==null?void 0:r.storageOptions)),this.relayer=new C_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new D_(this,this.logger),this.verify=new N_(this.projectId||"",this.logger),this.echoClient=new F_(this.projectId||"",this.logger)}static async init(r){const i=new Uu(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(X1,n),i}get context(){return tt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var r;return(r=this.logChunkController)==null?void 0:r.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}};const L_=z_,Hu="wc",Bu=2,Vu="client",No=`${Hu}@${Bu}:${Vu}:`,ho={name:Vu,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},tu="WALLETCONNECT_DEEPLINK_CHOICE",k_="proposal",Ku="Proposal expired",U_="session",$i=$.SEVEN_DAYS,H_="engine",lt={wc_sessionPropose:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1114},res:{ttl:$.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:$.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:$.ONE_HOUR,prompt:!1,tag:1117}}},uo={min:$.FIVE_MINUTES,max:$.SEVEN_DAYS},jt={idle:"IDLE",active:"ACTIVE"},B_="request",V_=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"],K_="wc",G_="auth",W_="authKeys",Q_="pairingTopics",J_="requests",Os=`${K_}@${1.5}:${G_}:`,Es=`${Os}:PUB_KEY`;var Y_=Object.defineProperty,Z_=Object.defineProperties,X_=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,eb=Object.prototype.hasOwnProperty,tb=Object.prototype.propertyIsEnumerable,ru=(u,r,i)=>r in u?Y_(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,xe=(u,r)=>{for(var i in r||(r={}))eb.call(r,i)&&ru(u,i,r[i]);if(iu)for(var i of iu(r))tb.call(r,i)&&ru(u,i,r[i]);return u},ji=(u,r)=>Z_(u,X_(r));class ib extends u0{constructor(r){super(r),this.name=H_,this.events=new Do,this.initialized=!1,this.requestQueue={state:jt.idle,queue:[]},this.sessionRequestQueue={state:jt.idle,queue:[]},this.requestQueueDelay=$.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(lt)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},$.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=ji(xe({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:l,sessionProperties:f,relays:w}=n;let P=o,A,x=!1;try{P&&(x=this.client.core.pairing.pairings.get(P).active)}catch(Z){throw this.client.logger.error(`connect() -> pairing.get(${P}) failed`),Z}if(!P||!x){const{topic:Z,uri:X}=await this.client.core.pairing.create();P=Z,A=X}if(!P){const{message:Z}=T("NO_MATCHING_KEY",`connect() pairing topic: ${P}`);throw new Error(Z)}const F=await this.client.core.crypto.generateKeyPair(),q=lt.wc_sessionPropose.req.ttl||$.FIVE_MINUTES,D=Fe(q),M=xe({requiredNamespaces:c,optionalNamespaces:l,relays:w??[{protocol:Lu}],proposer:{publicKey:F,metadata:this.client.metadata},expiryTimestamp:D},f&&{sessionProperties:f}),{reject:V,resolve:W,done:se}=fi(q,Ku);this.events.once(Y("session_connect"),async({error:Z,session:X})=>{if(Z)V(Z);else if(X){X.self.publicKey=F;const me=ji(xe({},X),{requiredNamespaces:M.requiredNamespaces,optionalNamespaces:M.optionalNamespaces});await this.client.session.set(X.topic,me),await this.setExpiry(X.topic,X.expiry),P&&await this.client.core.pairing.updateMetadata({topic:P,metadata:X.peer.metadata}),W(me)}});const te=await this.sendRequest({topic:P,method:"wc_sessionPropose",params:M,throwOnFailedPublish:!0});return await this.setProposal(te,xe({id:te},M)),{uri:A,approval:se}},this.pair=async i=>{await this.isInitialized();try{return await this.client.core.pairing.pair(i)}catch(n){throw this.client.logger.error("pair() failed"),n}},this.approve=async i=>{await this.isInitialized();try{await this.isValidApprove(i)}catch(se){throw this.client.logger.error("approve() -> isValidApprove() failed"),se}const{id:n,relayProtocol:o,namespaces:c,sessionProperties:l,sessionConfig:f}=i;let w;try{w=this.client.proposal.get(n)}catch(se){throw this.client.logger.error(`approve() -> proposal.get(${n}) failed`),se}let{pairingTopic:P,proposer:A,requiredNamespaces:x,optionalNamespaces:F}=w;P=P||"";const q=await this.client.core.crypto.generateKeyPair(),D=A.publicKey,M=await this.client.core.crypto.generateSharedKey(q,D),V=xe(xe({relay:{protocol:o??"irn"},namespaces:c,pairingTopic:P,controller:{publicKey:q,metadata:this.client.metadata},expiry:Fe($i)},l&&{sessionProperties:l}),f&&{sessionConfig:f});await this.client.core.relayer.subscribe(M);const W=ji(xe({},V),{topic:M,requiredNamespaces:x,optionalNamespaces:F,pairingTopic:P,acknowledged:!1,self:V.controller,peer:{publicKey:A.publicKey,metadata:A.metadata},controller:q});await this.client.session.set(M,W);try{await this.sendResult({id:n,topic:P,result:{relay:{protocol:o??"irn"},responderPublicKey:q},throwOnFailedPublish:!0}),await this.sendRequest({topic:M,method:"wc_sessionSettle",params:V,throwOnFailedPublish:!0})}catch(se){throw this.client.logger.error(se),this.client.session.delete(M,we("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(M),se}return await this.client.core.pairing.updateMetadata({topic:P,metadata:A.metadata}),await this.client.proposal.delete(n,we("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:P}),await this.setExpiry(M,Fe($i)),{topic:M,acknowledged:()=>new Promise(se=>setTimeout(()=>se(this.client.session.get(M)),500))}},this.reject=async i=>{await this.isInitialized();try{await this.isValidReject(i)}catch(l){throw this.client.logger.error("reject() -> isValidReject() failed"),l}const{id:n,reason:o}=i;let c;try{c=this.client.proposal.get(n).pairingTopic}catch(l){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),l}c&&(await this.sendError({id:n,topic:c,error:o}),await this.client.proposal.delete(n,we("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized();try{await this.isValidUpdate(i)}catch(x){throw this.client.logger.error("update() -> isValidUpdate() failed"),x}const{topic:n,namespaces:o}=i,{done:c,resolve:l,reject:f}=fi(),w=Fi(),P=gi().toString(),A=this.client.session.get(n).namespaces;return this.events.once(Y("session_update",w),({error:x})=>{x?f(x):l()}),await this.client.session.update(n,{namespaces:o}),this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o},throwOnFailedPublish:!0,clientRpcId:w,relayRpcId:P}).catch(x=>{this.client.logger.error(x),this.client.session.update(n,{namespaces:A}),f(x)}),{acknowledged:c}},this.extend=async i=>{await this.isInitialized();try{await this.isValidExtend(i)}catch(w){throw this.client.logger.error("extend() -> isValidExtend() failed"),w}const{topic:n}=i,o=Fi(),{done:c,resolve:l,reject:f}=fi();return this.events.once(Y("session_extend",o),({error:w})=>{w?f(w):l()}),await this.setExpiry(n,Fe($i)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:o,throwOnFailedPublish:!0}).catch(w=>{f(w)}),{acknowledged:c}},this.request=async i=>{await this.isInitialized();try{await this.isValidRequest(i)}catch(q){throw this.client.logger.error("request() -> isValidRequest() failed"),q}const{chainId:n,request:o,topic:c,expiry:l=lt.wc_sessionRequest.req.ttl}=i,f=this.client.session.get(c),w=Fi(),P=gi().toString(),{done:A,resolve:x,reject:F}=fi(l,"Request expired. Please try again.");return this.events.once(Y("session_request",w),({error:q,result:D})=>{q?F(q):x(D)}),await Promise.all([new Promise(async q=>{await this.sendRequest({clientRpcId:w,relayRpcId:P,topic:c,method:"wc_sessionRequest",params:{request:ji(xe({},o),{expiryTimestamp:Fe(l)}),chainId:n},expiry:l,throwOnFailedPublish:!0}).catch(D=>F(D)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:n,id:w}),q()}),new Promise(async q=>{var D;if(!((D=f.sessionConfig)!=null&&D.disableDeepLink)){const M=await gw(this.client.core.storage,tu);yw({id:w,topic:c,wcDeepLink:M})}q()}),A()]).then(q=>q[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:c}=o;Mt(o)?await this.sendResult({id:c,topic:n,result:o.result,throwOnFailedPublish:!0}):_t(o)&&await this.sendError({id:c,topic:n,error:o.error}),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized();try{await this.isValidPing(i)}catch(o){throw this.client.logger.error("ping() -> isValidPing() failed"),o}const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=Fi(),c=gi().toString(),{done:l,resolve:f,reject:w}=fi();this.events.once(Y("session_ping",o),({error:P})=>{P?w(P):f()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:c}),l()])}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:c}=i,l=gi().toString();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:c},throwOnFailedPublish:!0,relayRpcId:l})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:we("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:o}=T("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(o)}},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>mw(n,i))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async i=>{this.isInitialized(),this.isValidAuthenticate(i);const{chains:n,statement:o="",uri:c,domain:l,nonce:f,type:w,exp:P,nbf:A,methods:x=[]}=i,F=[...i.resources||[]],{topic:q,uri:D}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"]});this.client.logger.info({message:"Generated new pairing",pairing:{topic:q,uri:D}});const M=await this.client.core.crypto.generateKeyPair(),V=vs(M);if(await Promise.all([this.client.auth.authKeys.set(Es,{responseTopic:V,publicKey:M}),this.client.auth.pairingTopics.set(V,{topic:V,pairingTopic:q})]),await this.client.core.relayer.subscribe(V),this.client.logger.info(`sending request to new pairing topic: ${q}`),x.length>0){const{namespace:$e}=_s(n[0]);let be=vw($e,"request",x);eo(F)&&(be=ww(be,F.pop())),F.push(be)}const W=Fe(lt.wc_sessionPropose.req.ttl),se={authPayload:{type:w??"caip122",chains:n,statement:o,aud:c,domain:l,version:"1",nonce:f,iat:new Date().toISOString(),exp:P,nbf:A,resources:F},requester:{publicKey:M,metadata:this.client.metadata},expiryTimestamp:W},te={eip155:{chains:n,methods:[...new Set(["personal_sign",...x])],events:["chainChanged","accountsChanged"]}},Z={requiredNamespaces:{},optionalNamespaces:te,relays:[{protocol:"irn"}],proposer:{publicKey:M,metadata:this.client.metadata},expiryTimestamp:W},{done:X,resolve:me,reject:le}=fi(lt.wc_sessionAuthenticate.req.ttl,"Request expired"),ue=async({error:$e,session:be})=>{if(this.events.off(Y("session_request",Et),Le),$e)le($e);else if(be){be.self.publicKey=M,await this.client.session.set(be.topic,be),await this.setExpiry(be.topic,be.expiry),q&&await this.client.core.pairing.updateMetadata({topic:q,metadata:be.peer.metadata});const b=this.client.session.get(be.topic);me({session:b})}},Le=async $e=>{if($e.error){const ie=we("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return $e.error.code===ie.code?void 0:(this.events.off(Y("session_connect"),ue),le($e.error.message))}this.events.off(Y("session_connect"),ue);const{cacaos:be,responder:b}=$e.result,C=[],H=[];for(const ie of be){await bh({cacao:ie,projectId:this.client.core.projectId})||(this.client.logger.error(ie,"Signature verification failed"),le(we("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ge}=ie,Pe=eo(Ge.resources),Ut=[Eh(Ge.iss)],Ds=Ih(Ge.iss);if(Pe){const Bi=Ph(Pe),Ht=Sh(Pe);C.push(...Bi),Ut.push(...Ht)}for(const Bi of Ut)H.push(`${Bi}:${Ds}`)}const ce=await this.client.core.crypto.generateSharedKey(M,b.publicKey);let ne;C.length>0&&(ne={topic:ce,acknowledged:!0,self:{publicKey:M,metadata:this.client.metadata},peer:b,controller:b.publicKey,expiry:Fe($i),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:q,namespaces:Rh([...new Set(C)],[...new Set(H)])},await this.client.core.relayer.subscribe(ce),await this.client.session.set(ce,ne),ne=this.client.session.get(ce)),me({auths:be,session:ne})},Et=Fi(),Te=Fi();this.events.once(Y("session_connect"),ue),this.events.once(Y("session_request",Et),Le);try{await Promise.all([this.sendRequest({topic:q,method:"wc_sessionAuthenticate",params:se,expiry:i.expiry,throwOnFailedPublish:!0,clientRpcId:Et}),this.sendRequest({topic:q,method:"wc_sessionPropose",params:Z,expiry:lt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Te})])}catch($e){throw this.events.off(Y("session_connect"),ue),this.events.off(Y("session_request",Et),Le),$e}return await this.setProposal(Te,xe({id:Te},Z)),await this.client.auth.requests.set(Et,{authPayload:se.authPayload,requester:se.requester,expiryTimestamp:W,id:Et,pairingTopic:q,verifyContext:{}}),{uri:D,response:X}},this.approveSessionAuthenticate=async i=>{this.isInitialized();const{id:n,auths:o}=i,c=this.getPendingAuthRequest(n);if(!c)throw new Error(`Could not find pending auth request with id ${n}`);const l=c.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),w=vs(l),P={type:wo,receiverPublicKey:l,senderPublicKey:f},A=[],x=[];for(const D of o){if(!await bh({cacao:D,projectId:this.client.core.projectId})){const te=we("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:w,error:te,encodeOpts:P}),new Error(te.message)}const{p:M}=D,V=eo(M.resources),W=[Eh(M.iss)],se=Ih(M.iss);if(V){const te=Ph(V),Z=Sh(V);A.push(...te),W.push(...Z)}for(const te of W)x.push(`${te}:${se}`)}const F=await this.client.core.crypto.generateSharedKey(f,l);let q;return(A==null?void 0:A.length)>0&&(q={topic:F,acknowledged:!0,self:{publicKey:f,metadata:this.client.metadata},peer:{publicKey:l,metadata:c.requester.metadata},controller:l,expiry:Fe($i),authentication:o,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:"",namespaces:Rh([...new Set(A)],[...new Set(x)])},await this.client.core.relayer.subscribe(F),await this.client.session.set(F,q)),await this.sendResult({topic:w,id:n,result:{cacaos:o,responder:{publicKey:f,metadata:this.client.metadata}},encodeOpts:P,throwOnFailedPublish:!0}),await this.client.auth.requests.delete(n,{message:"fullfilled",code:0}),await this.client.core.pairing.activate({topic:c.pairingTopic}),{session:q}},this.rejectSessionAuthenticate=async i=>{await this.isInitialized();const{id:n,reason:o}=i,c=this.getPendingAuthRequest(n);if(!c)throw new Error(`Could not find pending auth request with id ${n}`);const l=c.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),w=vs(l),P={type:wo,receiverPublicKey:l,senderPublicKey:f};await this.sendError({id:n,topic:w,error:o,encodeOpts:P}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.client.proposal.delete(n,we("USER_DISCONNECTED"))},this.formatAuthMessage=i=>{this.isInitialized();const{request:n,iss:o}=i;return _w(n,o)},this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var l,f;return((l=c.peerMetadata)==null?void 0:l.url)&&((f=c.peerMetadata)==null?void 0:f.url)===i.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async i=>{const{topic:n,expirerHasDeleted:o=!1,emitEvent:c=!0,id:l=0}=i,{self:f}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,we("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(f.publicKey)&&await this.client.core.crypto.deleteKeyPair(f.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),o||this.client.core.expirer.del(n),this.client.core.storage.removeItem(tu).catch(w=>this.client.logger.warn(w)),this.getPendingSessionRequests().forEach(w=>{w.topic===n&&this.deletePendingSessionRequest(w.id,we("USER_DISCONNECTED"))}),c&&this.client.events.emit("session_delete",{id:l,topic:n})},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,we("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"proposal")},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==i),o&&(this.sessionRequestQueue.state=jt.idle,this.client.events.emit("session_request_expire",{id:i}))},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,Fe(lt.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async i=>{const{id:n,topic:o,params:c,verifyContext:l}=i,f=c.request.expiryTimestamp||Fe(lt.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(n,{id:n,topic:o,params:c,verifyContext:l}),f&&this.client.core.expirer.set(n,f)},this.sendRequest=async i=>{const{topic:n,method:o,params:c,expiry:l,relayRpcId:f,clientRpcId:w,throwOnFailedPublish:P}=i,A=ki(o,c,w);if(Eu()&&V_.includes(o)){const q=yi(JSON.stringify(A));this.client.core.verify.register({attestationId:q})}let x;try{x=await this.client.core.crypto.encode(n,A)}catch(q){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),q}const F=lt[o].req;return l&&(F.ttl=l),f&&(F.id=f),this.client.core.history.set(n,A),P?(F.internal=ji(xe({},F.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,x,F)):this.client.core.relayer.publish(n,x,F).catch(q=>this.client.logger.error(q)),A.id},this.sendResult=async i=>{const{id:n,topic:o,result:c,throwOnFailedPublish:l,encodeOpts:f}=i,w=xs(n,c);let P;try{P=await this.client.core.crypto.encode(o,w,f)}catch(F){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${o} failed`),F}let A;try{A=await this.client.core.history.get(o,n)}catch(F){throw this.client.logger.error(`sendResult() -> history.get(${o}, ${n}) failed`),F}const x=lt[A.request.method].res;l?(x.internal=ji(xe({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,P,x)):this.client.core.relayer.publish(o,P,x).catch(F=>this.client.logger.error(F)),await this.client.core.history.resolve(w)},this.sendError=async i=>{const{id:n,topic:o,error:c,encodeOpts:l}=i,f=To(n,c);let w;try{w=await this.client.core.crypto.encode(o,f,l)}catch(x){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${o} failed`),x}let P;try{P=await this.client.core.history.get(o,n)}catch(x){throw this.client.logger.error(`sendError() -> history.get(${o}, ${n}) failed`),x}const A=lt[P.request.method].res;this.client.core.relayer.publish(o,w,A),await this.client.core.history.resolve(f)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{let c=!1;Xt(o.expiry)&&(c=!0),this.client.core.crypto.keychain.has(o.topic)||(c=!0),c&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Xt(o.expiryTimestamp)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession({topic:o})),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===jt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=jt.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=jt.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,c=o.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);case"wc_sessionAuthenticate":return this.onSessionAuthenticateRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,c=(await this.client.core.history.get(n,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=T("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.shouldIgnorePairingRequest=i=>{const{topic:n,requestMethod:o}=i,c=this.expectedPairingMethodMap.get(n);return!c||c.includes(o)?!1:!!(c.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:c}=n;try{this.isValidConnect(xe({},n.params));const l=o.expiryTimestamp||Fe(lt.wc_sessionPropose.req.ttl),f=xe({id:c,pairingTopic:i,expiryTimestamp:l},o);await this.setProposal(c,f);const w=yi(JSON.stringify(n)),P=await this.getVerifyContext(w,f.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:f,verifyContext:P})}catch(l){await this.sendError({id:c,topic:i,error:l}),this.client.logger.error(l)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(Mt(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const l=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const f=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:f});const w=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const P=await this.client.core.crypto.generateSharedKey(f,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:P});const A=await this.client.core.relayer.subscribe(P);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:A}),await this.client.core.pairing.activate({topic:i})}else if(_t(n)){await this.client.proposal.delete(o,we("USER_DISCONNECTED"));const c=Y("session_connect");if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners, 954`);this.events.emit(Y("session_connect"),{error:n.error})}},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:l,controller:f,expiry:w,namespaces:P,sessionProperties:A,pairingTopic:x,sessionConfig:F}=n.params,q=xe(xe({topic:i,relay:l,expiry:w,namespaces:P,acknowledged:!0,pairingTopic:x,requiredNamespaces:{},optionalNamespaces:{},controller:f.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:f.publicKey,metadata:f.metadata}},A&&{sessionProperties:A}),F&&{sessionConfig:F});await this.sendResult({id:n.id,topic:i,result:!0,throwOnFailedPublish:!0});const D=Y("session_connect");if(this.events.listenerCount(D)===0)throw new Error(`emitting ${D} without any listeners 997`);this.events.emit(Y("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(l){await this.sendError({id:o,topic:i,error:l}),this.client.logger.error(l)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;Mt(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(Y("session_approve",o),{})):_t(n)&&(await this.client.session.delete(i,we("USER_DISCONNECTED")),this.events.emit(Y("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:c}=n;try{const l=`${i}_session_update`,f=dr.get(l);if(f&&this.isRequestOutOfSync(f,c)){this.client.logger.info(`Discarding out of sync request - ${c}`),this.sendError({id:c,topic:i,error:we("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(xe({topic:i},o));try{dr.set(l,c),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:i,result:!0,throwOnFailedPublish:!0})}catch(w){throw dr.delete(l),w}this.client.events.emit("session_update",{id:c,topic:i,params:o})}catch(l){await this.sendError({id:c,topic:i,error:l}),this.client.logger.error(l)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n,c=Y("session_update",o);if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners`);Mt(n)?this.events.emit(Y("session_update",o),{}):_t(n)&&this.events.emit(Y("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Fe($i)),await this.sendResult({id:o,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(c){await this.sendError({id:o,topic:i,error:c}),this.client.logger.error(c)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n,c=Y("session_extend",o);if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners`);Mt(n)?this.events.emit(Y("session_extend",o),{}):_t(n)&&this.events.emit(Y("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(c){await this.sendError({id:o,topic:i,error:c}),this.client.logger.error(c)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n,c=Y("session_ping",o);if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners`);setTimeout(()=>{Mt(n)?this.events.emit(Y("session_ping",o),{}):_t(n)&&this.events.emit(Y("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(et.publish,async()=>{c(await this.deleteSession({topic:i,id:o}))})}),this.sendResult({id:o,topic:i,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:i,error:we("USER_DISCONNECTED")})])}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:c}=n;try{await this.isValidRequest(xe({topic:i},c));const l=yi(JSON.stringify(ki("wc_sessionRequest",c,o))),f=this.client.session.get(i),w=await this.getVerifyContext(l,f.peer.metadata),P={id:o,topic:i,params:c,verifyContext:w};await this.setPendingSessionRequest(P),this.addSessionRequestToSessionRequestQueue(P),this.processSessionRequestQueue()}catch(l){await this.sendError({id:o,topic:i,error:l}),this.client.logger.error(l)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n,c=Y("session_request",o);if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners`);Mt(n)?this.events.emit(Y("session_request",o),{result:n.result}):_t(n)&&this.events.emit(Y("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:c}=n;try{const l=`${i}_session_event_${c.event.name}`,f=dr.get(l);if(f&&this.isRequestOutOfSync(f,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(xe({topic:i},c)),this.client.events.emit("session_event",{id:o,topic:i,params:c}),dr.set(l,o)}catch(l){await this.sendError({id:o,topic:i,error:l}),this.client.logger.error(l)}},this.onSessionAuthenticateResponse=(i,n)=>{const{id:o}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:n}),Mt(n)?this.events.emit(Y("session_request",o),{result:n.result}):_t(n)&&this.events.emit(Y("session_request",o),{error:n.error})},this.onSessionAuthenticateRequest=async(i,n)=>{const{requester:o,authPayload:c,expiryTimestamp:l}=n.params,f=yi(JSON.stringify(n)),w=await this.getVerifyContext(f,this.client.metadata),P={requester:o,pairingTopic:i,id:n.id,authPayload:c,verifyContext:w,expiryTimestamp:l};await this.client.auth.requests.set(n.id,P),this.client.events.emit("session_authenticate",{topic:i,params:n.params,id:n.id})},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=jt.idle,this.processSessionRequestQueue()},$.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:i,error:n})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(c=>c.topic===i&&c.request.method==="wc_sessionRequest").forEach(c=>{const l=c.request.id,f=Y("session_request",l);if(this.events.listenerCount(f)===0)throw new Error(`emitting ${f} without any listeners`);this.events.emit(Y("session_request",c.request.id),{error:n})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===jt.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=jt.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,ki("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async i=>{if(!Ve(i)){const{message:w}=T("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:l,relays:f}=i;if(ei(n)||await this.isValidPairingTopic(n),!bw(f,!0)){const{message:w}=T("MISSING_OR_INVALID",`connect() relays: ${f}`);throw new Error(w)}!ei(o)&&bo(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!ei(c)&&bo(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),ei(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=Ew(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!Ve(i))throw new Error(T("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:c,sessionProperties:l}=i;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const f=this.client.proposal.get(n),w=to(o,"approve()");if(w)throw new Error(w.message);const P=Ch(f.requiredNamespaces,o,"approve()");if(P)throw new Error(P.message);if(!zt(c,!0)){const{message:A}=T("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(A)}ei(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async i=>{if(!Ve(i)){const{message:c}=T("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(c)}const{id:n,reason:o}=i;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!Iw(o)){const{message:c}=T("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=i=>{if(!Ve(i)){const{message:P}=T("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(P)}const{relay:n,controller:o,namespaces:c,expiry:l}=i;if(!Pw(n)){const{message:P}=T("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(P)}const f=Sw(o,"onSessionSettleRequest()");if(f)throw new Error(f.message);const w=to(c,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Xt(l)){const{message:P}=T("EXPIRED","onSessionSettleRequest()");throw new Error(P)}},this.isValidUpdate=async i=>{if(!Ve(i)){const{message:w}=T("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:o}=i;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const c=this.client.session.get(n),l=to(o,"update()");if(l)throw new Error(l.message);const f=Ch(c.requiredNamespaces,o,"update()");if(f)throw new Error(f.message)},this.isValidExtend=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!Ve(i)){const{message:w}=T("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:o,chainId:c,expiry:l}=i;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!xh(f,c)){const{message:w}=T("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(w)}if(!Rw(o)){const{message:w}=T("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!Cw(f,c,o.method)){const{message:w}=T("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(l&&!xw(l,uo)){const{message:w}=T("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${uo.min} and ${uo.max}`);throw new Error(w)}},this.isValidRespond=async i=>{var n;if(!Ve(i)){const{message:l}=T("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(l)}const{topic:o,response:c}=i;try{await this.isValidSessionTopic(o)}catch(l){throw(n=i==null?void 0:i.response)!=null&&n.id&&this.cleanupAfterResponse(i),l}if(!Aw(c)){const{message:l}=T("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(l)}},this.isValidPing=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!Ve(i)){const{message:f}=T("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(f)}const{topic:n,event:o,chainId:c}=i;await this.isValidSessionTopic(n);const{namespaces:l}=this.client.session.get(n);if(!xh(l,c)){const{message:f}=T("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(f)}if(!Ow(o)){const{message:f}=T("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(f)}if(!Dw(l,c,o.name)){const{message:f}=T("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(f)}},this.isValidDisconnect=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidAuthenticate=i=>{const{chains:n,uri:o,domain:c,nonce:l}=i;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!zt(o,!1))throw new Error("uri is required parameter");if(!zt(c,!1))throw new Error("domain is required parameter");if(!zt(l,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(w=>_s(w).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:f}=_s(n[0]);if(f!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||Li,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!zt(o,!1)){const{message:c}=T("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})},this.getPendingAuthRequest=i=>{const n=this.client.auth.requests.get(i);return typeof n=="object"?n:void 0},this.addToRecentlyDeleted=(i,n)=>{if(this.recentlyDeletedMap.set(i,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let o=0;const c=this.recentlyDeletedLimit/2;for(const l of this.recentlyDeletedMap.keys()){if(o++>=c)break;this.recentlyDeletedMap.delete(l)}}},this.checkRecentlyDeleted=i=>{const n=this.recentlyDeletedMap.get(i);if(n){const{message:o}=T("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${i}`);throw new Error(o)}}}async isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(et.message,async r=>{const{topic:i,message:n}=r,{publicKey:o}=this.client.auth.authKeys.keys.includes(Es)?this.client.auth.authKeys.get(Es):{responseTopic:void 0,publicKey:void 0},c=await this.client.core.crypto.decode(i,n,{receiverPublicKey:o});try{Oo(c)?(this.client.core.history.set(i,c),this.onRelayEventRequest({topic:i,payload:c})):Rs(c)?(await this.client.core.history.resolve(c),await this.onRelayEventResponse({topic:i,payload:c}),this.client.core.history.delete(i,c.id)):this.onRelayEventUnknownPayload({topic:i,payload:c})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(pt.expired,async r=>{const{topic:i,id:n}=bu(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,T("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession({topic:i,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(zi.create,r=>this.onPairingCreated(r)),this.client.core.pairing.events.on(zi.delete,r=>{this.addToRecentlyDeleted(r.topic,"pairing")})}isValidPairingTopic(r){if(!zt(r,!1)){const{message:i}=T("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Xt(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=T("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!zt(r,!1)){const{message:i}=T("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(this.checkRecentlyDeleted(r),!this.client.session.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Xt(this.client.session.get(r).expiry)){await this.deleteSession({topic:r});const{message:i}=T("EXPIRED",`session topic: ${r}`);throw new Error(i)}if(!this.client.core.crypto.keychain.has(r)){const{message:i}=T("MISSING_OR_INVALID",`session topic does not exist in keychain: ${r}`);throw await this.deleteSession({topic:r}),new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.checkRecentlyDeleted(r),this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(zt(r,!1)){const{message:i}=T("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=T("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Tw(r)){const{message:i}=T("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Xt(this.client.proposal.get(r).expiryTimestamp)){await this.deleteProposal(r);const{message:i}=T("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class rb extends vi{constructor(r,i){super(r,i,k_,No),this.core=r,this.logger=i}}class sb extends vi{constructor(r,i){super(r,i,U_,No),this.core=r,this.logger=i}}class nb extends vi{constructor(r,i){super(r,i,B_,No,n=>n.id),this.core=r,this.logger=i}}class ob extends vi{constructor(r,i){super(r,i,W_,Os,()=>Es),this.core=r,this.logger=i}}class ab extends vi{constructor(r,i){super(r,i,Q_,Os),this.core=r,this.logger=i}}class cb extends vi{constructor(r,i){super(r,i,J_,Os,n=>n.id),this.core=r,this.logger=i}}class hb{constructor(r,i){this.core=r,this.logger=i,this.authKeys=new ob(this.core,this.logger),this.pairingTopics=new ab(this.core,this.logger),this.requests=new cb(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}class Fo extends h0{constructor(r){super(r),this.protocol=Hu,this.version=Bu,this.name=ho.name,this.events=new bt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.authenticate=async n=>{try{return await this.engine.authenticate(n)}catch(o){throw this.logger.error(o.message),o}},this.formatAuthMessage=n=>{try{return this.engine.formatAuthMessage(n)}catch(o){throw this.logger.error(o.message),o}},this.approveSessionAuthenticate=async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(o){throw this.logger.error(o.message),o}},this.rejectSessionAuthenticate=async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(o){throw this.logger.error(o.message),o}},this.name=(r==null?void 0:r.name)||ho.name,this.metadata=(r==null?void 0:r.metadata)||fw();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ao(Cs({level:(r==null?void 0:r.logger)||ho.logger}));this.core=(r==null?void 0:r.core)||new L_(r),this.logger=Ke(i,this.name),this.session=new sb(this.core,this.logger),this.proposal=new rb(this.core,this.logger),this.pendingRequest=new nb(this.core,this.logger),this.engine=new ib(this),this.auth=new hb(this.core,this.logger)}static async init(r){const i=new Fo(r);return await i.initialize(),i}get context(){return tt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),await this.auth.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}var So={exports:{}};(function(u,r){var i=typeof self<"u"?self:qw,n=function(){function c(){this.fetch=!1,this.DOMException=i.DOMException}return c.prototype=i,new c}();(function(c){(function(l){var f={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function w(b){return b&&DataView.prototype.isPrototypeOf(b)}if(f.arrayBuffer)var P=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],A=ArrayBuffer.isView||function(b){return b&&P.indexOf(Object.prototype.toString.call(b))>-1};function x(b){if(typeof b!="string"&&(b=String(b)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(b))throw new TypeError("Invalid character in header field name");return b.toLowerCase()}function F(b){return typeof b!="string"&&(b=String(b)),b}function q(b){var C={next:function(){var H=b.shift();return{done:H===void 0,value:H}}};return f.iterable&&(C[Symbol.iterator]=function(){return C}),C}function D(b){this.map={},b instanceof D?b.forEach(function(C,H){this.append(H,C)},this):Array.isArray(b)?b.forEach(function(C){this.append(C[0],C[1])},this):b&&Object.getOwnPropertyNames(b).forEach(function(C){this.append(C,b[C])},this)}D.prototype.append=function(b,C){b=x(b),C=F(C);var H=this.map[b];this.map[b]=H?H+", "+C:C},D.prototype.delete=function(b){delete this.map[x(b)]},D.prototype.get=function(b){return b=x(b),this.has(b)?this.map[b]:null},D.prototype.has=function(b){return this.map.hasOwnProperty(x(b))},D.prototype.set=function(b,C){this.map[x(b)]=F(C)},D.prototype.forEach=function(b,C){for(var H in this.map)this.map.hasOwnProperty(H)&&b.call(C,this.map[H],H,this)},D.prototype.keys=function(){var b=[];return this.forEach(function(C,H){b.push(H)}),q(b)},D.prototype.values=function(){var b=[];return this.forEach(function(C){b.push(C)}),q(b)},D.prototype.entries=function(){var b=[];return this.forEach(function(C,H){b.push([H,C])}),q(b)},f.iterable&&(D.prototype[Symbol.iterator]=D.prototype.entries);function M(b){if(b.bodyUsed)return Promise.reject(new TypeError("Already read"));b.bodyUsed=!0}function V(b){return new Promise(function(C,H){b.onload=function(){C(b.result)},b.onerror=function(){H(b.error)}})}function W(b){var C=new FileReader,H=V(C);return C.readAsArrayBuffer(b),H}function se(b){var C=new FileReader,H=V(C);return C.readAsText(b),H}function te(b){for(var C=new Uint8Array(b),H=new Array(C.length),ce=0;ce<C.length;ce++)H[ce]=String.fromCharCode(C[ce]);return H.join("")}function Z(b){if(b.slice)return b.slice(0);var C=new Uint8Array(b.byteLength);return C.set(new Uint8Array(b)),C.buffer}function X(){return this.bodyUsed=!1,this._initBody=function(b){this._bodyInit=b,b?typeof b=="string"?this._bodyText=b:f.blob&&Blob.prototype.isPrototypeOf(b)?this._bodyBlob=b:f.formData&&FormData.prototype.isPrototypeOf(b)?this._bodyFormData=b:f.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)?this._bodyText=b.toString():f.arrayBuffer&&f.blob&&w(b)?(this._bodyArrayBuffer=Z(b.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):f.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(b)||A(b))?this._bodyArrayBuffer=Z(b):this._bodyText=b=Object.prototype.toString.call(b):this._bodyText="",this.headers.get("content-type")||(typeof b=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):f.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},f.blob&&(this.blob=function(){var b=M(this);if(b)return b;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?M(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(W)}),this.text=function(){var b=M(this);if(b)return b;if(this._bodyBlob)return se(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(te(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(Le)}),this.json=function(){return this.text().then(JSON.parse)},this}var me=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function le(b){var C=b.toUpperCase();return me.indexOf(C)>-1?C:b}function ue(b,C){C=C||{};var H=C.body;if(b instanceof ue){if(b.bodyUsed)throw new TypeError("Already read");this.url=b.url,this.credentials=b.credentials,C.headers||(this.headers=new D(b.headers)),this.method=b.method,this.mode=b.mode,this.signal=b.signal,!H&&b._bodyInit!=null&&(H=b._bodyInit,b.bodyUsed=!0)}else this.url=String(b);if(this.credentials=C.credentials||this.credentials||"same-origin",(C.headers||!this.headers)&&(this.headers=new D(C.headers)),this.method=le(C.method||this.method||"GET"),this.mode=C.mode||this.mode||null,this.signal=C.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&H)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(H)}ue.prototype.clone=function(){return new ue(this,{body:this._bodyInit})};function Le(b){var C=new FormData;return b.trim().split("&").forEach(function(H){if(H){var ce=H.split("="),ne=ce.shift().replace(/\+/g," "),ie=ce.join("=").replace(/\+/g," ");C.append(decodeURIComponent(ne),decodeURIComponent(ie))}}),C}function Et(b){var C=new D,H=b.replace(/\r?\n[\t ]+/g," ");return H.split(/\r?\n/).forEach(function(ce){var ne=ce.split(":"),ie=ne.shift().trim();if(ie){var Ge=ne.join(":").trim();C.append(ie,Ge)}}),C}X.call(ue.prototype);function Te(b,C){C||(C={}),this.type="default",this.status=C.status===void 0?200:C.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in C?C.statusText:"OK",this.headers=new D(C.headers),this.url=C.url||"",this._initBody(b)}X.call(Te.prototype),Te.prototype.clone=function(){return new Te(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new D(this.headers),url:this.url})},Te.error=function(){var b=new Te(null,{status:0,statusText:""});return b.type="error",b};var $e=[301,302,303,307,308];Te.redirect=function(b,C){if($e.indexOf(C)===-1)throw new RangeError("Invalid status code");return new Te(null,{status:C,headers:{location:b}})},l.DOMException=c.DOMException;try{new l.DOMException}catch{l.DOMException=function(C,H){this.message=C,this.name=H;var ce=Error(C);this.stack=ce.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function be(b,C){return new Promise(function(H,ce){var ne=new ue(b,C);if(ne.signal&&ne.signal.aborted)return ce(new l.DOMException("Aborted","AbortError"));var ie=new XMLHttpRequest;function Ge(){ie.abort()}ie.onload=function(){var Pe={status:ie.status,statusText:ie.statusText,headers:Et(ie.getAllResponseHeaders()||"")};Pe.url="responseURL"in ie?ie.responseURL:Pe.headers.get("X-Request-URL");var Ut="response"in ie?ie.response:ie.responseText;H(new Te(Ut,Pe))},ie.onerror=function(){ce(new TypeError("Network request failed"))},ie.ontimeout=function(){ce(new TypeError("Network request failed"))},ie.onabort=function(){ce(new l.DOMException("Aborted","AbortError"))},ie.open(ne.method,ne.url,!0),ne.credentials==="include"?ie.withCredentials=!0:ne.credentials==="omit"&&(ie.withCredentials=!1),"responseType"in ie&&f.blob&&(ie.responseType="blob"),ne.headers.forEach(function(Pe,Ut){ie.setRequestHeader(Ut,Pe)}),ne.signal&&(ne.signal.addEventListener("abort",Ge),ie.onreadystatechange=function(){ie.readyState===4&&ne.signal.removeEventListener("abort",Ge)}),ie.send(typeof ne._bodyInit>"u"?null:ne._bodyInit)})}return be.polyfill=!0,c.fetch||(c.fetch=be,c.Headers=D,c.Request=ue,c.Response=Te),l.Headers=D,l.Request=ue,l.Response=Te,l.fetch=be,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;r=o.fetch,r.default=o.fetch,r.fetch=o.fetch,r.Headers=o.Headers,r.Request=o.Request,r.Response=o.Response,u.exports=r})(So,So.exports);var ub=So.exports;const su=Nw(ub);var lb=Object.defineProperty,pb=Object.defineProperties,db=Object.getOwnPropertyDescriptors,nu=Object.getOwnPropertySymbols,fb=Object.prototype.hasOwnProperty,gb=Object.prototype.propertyIsEnumerable,ou=(u,r,i)=>r in u?lb(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,au=(u,r)=>{for(var i in r||(r={}))fb.call(r,i)&&ou(u,i,r[i]);if(nu)for(var i of nu(r))gb.call(r,i)&&ou(u,i,r[i]);return u},cu=(u,r)=>pb(u,db(r));const yb={Accept:"application/json","Content-Type":"application/json"},mb="POST",hu={headers:yb,method:mb},uu=10;class ri{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new bt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Ah(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r){this.isAvailable||await this.register();try{const i=_r(r),n=await(await su(this.url,cu(au({},hu),{body:i}))).json();this.onPayload({data:n})}catch(i){this.onError(r.id,i)}}async register(r=this.url){if(!Ah(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=_r({id:1,jsonrpc:"2.0",method:"test",params:[]});await su(r,cu(au({},hu),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Ps(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),c=To(r,o);this.events.emit("payload",c)}parseError(r,i=this.url){return Fw(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>uu&&this.events.setMaxListeners(uu)}}const lu="error",vb="wss://relay.walletconnect.com",wb="wc",_b="universal_provider",pu=`${wb}@2:${_b}:`,bb="https://rpc.walletconnect.com/v1/",kt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ro={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(u,r){(function(){var i,n="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",f="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",P=500,A="__lodash_placeholder__",x=1,F=2,q=4,D=1,M=2,V=1,W=2,se=4,te=8,Z=16,X=32,me=64,le=128,ue=256,Le=512,Et=30,Te="...",$e=800,be=16,b=1,C=2,H=3,ce=1/0,ne=9007199254740991,ie=17976931348623157e292,Ge=0/0,Pe=4294967295,Ut=Pe-1,Ds=Pe>>>1,Bi=[["ary",le],["bind",V],["bindKey",W],["curry",te],["curryRight",Z],["flip",Le],["partial",X],["partialRight",me],["rearg",ue]],Ht="[object Arguments]",Ir="[object Array]",Qu="[object AsyncFunction]",Vi="[object Boolean]",Ki="[object Date]",Ju="[object DOMException]",Pr="[object Error]",Sr="[object Function]",Mo="[object GeneratorFunction]",dt="[object Map]",Gi="[object Number]",Yu="[object Null]",Ct="[object Object]",zo="[object Promise]",Zu="[object Proxy]",Wi="[object RegExp]",ft="[object Set]",Qi="[object String]",Rr="[object Symbol]",Xu="[object Undefined]",Ji="[object WeakMap]",el="[object WeakSet]",Yi="[object ArrayBuffer]",_i="[object DataView]",Ts="[object Float32Array]",qs="[object Float64Array]",Ns="[object Int8Array]",Fs="[object Int16Array]",$s="[object Int32Array]",js="[object Uint8Array]",Ms="[object Uint8ClampedArray]",zs="[object Uint16Array]",Ls="[object Uint32Array]",tl=/\b__p \+= '';/g,il=/\b(__p \+=) '' \+/g,rl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Lo=/&(?:amp|lt|gt|quot|#39);/g,ko=/[&<>"']/g,sl=RegExp(Lo.source),nl=RegExp(ko.source),ol=/<%-([\s\S]+?)%>/g,al=/<%([\s\S]+?)%>/g,Uo=/<%=([\s\S]+?)%>/g,cl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hl=/^\w*$/,ul=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ks=/[\\^$.*+?()[\]{}|]/g,ll=RegExp(ks.source),Us=/^\s+/,pl=/\s/,dl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,fl=/\{\n\/\* \[wrapped with (.+)\] \*/,gl=/,? & /,yl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ml=/[()=,{}\[\]\/\s]/,vl=/\\(\\)?/g,wl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ho=/\w*$/,_l=/^[-+]0x[0-9a-f]+$/i,bl=/^0b[01]+$/i,El=/^\[object .+?Constructor\]$/,Il=/^0o[0-7]+$/i,Pl=/^(?:0|[1-9]\d*)$/,Sl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Cr=/($^)/,Rl=/['\n\r\u2028\u2029\\]/g,xr="\\ud800-\\udfff",Cl="\\u0300-\\u036f",xl="\\ufe20-\\ufe2f",Al="\\u20d0-\\u20ff",Bo=Cl+xl+Al,Vo="\\u2700-\\u27bf",Ko="a-z\\xdf-\\xf6\\xf8-\\xff",Ol="\\xac\\xb1\\xd7\\xf7",Dl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Tl="\\u2000-\\u206f",ql=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Go="A-Z\\xc0-\\xd6\\xd8-\\xde",Wo="\\ufe0e\\ufe0f",Qo=Ol+Dl+Tl+ql,Hs="['’]",Nl="["+xr+"]",Jo="["+Qo+"]",Ar="["+Bo+"]",Yo="\\d+",Fl="["+Vo+"]",Zo="["+Ko+"]",Xo="[^"+xr+Qo+Yo+Vo+Ko+Go+"]",Bs="\\ud83c[\\udffb-\\udfff]",$l="(?:"+Ar+"|"+Bs+")",ea="[^"+xr+"]",Vs="(?:\\ud83c[\\udde6-\\uddff]){2}",Ks="[\\ud800-\\udbff][\\udc00-\\udfff]",bi="["+Go+"]",ta="\\u200d",ia="(?:"+Zo+"|"+Xo+")",jl="(?:"+bi+"|"+Xo+")",ra="(?:"+Hs+"(?:d|ll|m|re|s|t|ve))?",sa="(?:"+Hs+"(?:D|LL|M|RE|S|T|VE))?",na=$l+"?",oa="["+Wo+"]?",Ml="(?:"+ta+"(?:"+[ea,Vs,Ks].join("|")+")"+oa+na+")*",zl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ll="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",aa=oa+na+Ml,kl="(?:"+[Fl,Vs,Ks].join("|")+")"+aa,Ul="(?:"+[ea+Ar+"?",Ar,Vs,Ks,Nl].join("|")+")",Hl=RegExp(Hs,"g"),Bl=RegExp(Ar,"g"),Gs=RegExp(Bs+"(?="+Bs+")|"+Ul+aa,"g"),Vl=RegExp([bi+"?"+Zo+"+"+ra+"(?="+[Jo,bi,"$"].join("|")+")",jl+"+"+sa+"(?="+[Jo,bi+ia,"$"].join("|")+")",bi+"?"+ia+"+"+ra,bi+"+"+sa,Ll,zl,Yo,kl].join("|"),"g"),Kl=RegExp("["+ta+xr+Bo+Wo+"]"),Gl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Wl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ql=-1,fe={};fe[Ts]=fe[qs]=fe[Ns]=fe[Fs]=fe[$s]=fe[js]=fe[Ms]=fe[zs]=fe[Ls]=!0,fe[Ht]=fe[Ir]=fe[Yi]=fe[Vi]=fe[_i]=fe[Ki]=fe[Pr]=fe[Sr]=fe[dt]=fe[Gi]=fe[Ct]=fe[Wi]=fe[ft]=fe[Qi]=fe[Ji]=!1;var de={};de[Ht]=de[Ir]=de[Yi]=de[_i]=de[Vi]=de[Ki]=de[Ts]=de[qs]=de[Ns]=de[Fs]=de[$s]=de[dt]=de[Gi]=de[Ct]=de[Wi]=de[ft]=de[Qi]=de[Rr]=de[js]=de[Ms]=de[zs]=de[Ls]=!0,de[Pr]=de[Sr]=de[Ji]=!1;var Jl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Yl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Zl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Xl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ep=parseFloat,tp=parseInt,ca=typeof vr=="object"&&vr&&vr.Object===Object&&vr,ip=typeof self=="object"&&self&&self.Object===Object&&self,Ae=ca||ip||Function("return this")(),Ws=r&&!r.nodeType&&r,si=Ws&&!0&&u&&!u.nodeType&&u,ha=si&&si.exports===Ws,Qs=ha&&ca.process,it=function(){try{var m=si&&si.require&&si.require("util").types;return m||Qs&&Qs.binding&&Qs.binding("util")}catch{}}(),ua=it&&it.isArrayBuffer,la=it&&it.isDate,pa=it&&it.isMap,da=it&&it.isRegExp,fa=it&&it.isSet,ga=it&&it.isTypedArray;function We(m,E,_){switch(_.length){case 0:return m.call(E);case 1:return m.call(E,_[0]);case 2:return m.call(E,_[0],_[1]);case 3:return m.call(E,_[0],_[1],_[2])}return m.apply(E,_)}function rp(m,E,_,N){for(var U=-1,oe=m==null?0:m.length;++U<oe;){var Se=m[U];E(N,Se,_(Se),m)}return N}function rt(m,E){for(var _=-1,N=m==null?0:m.length;++_<N&&E(m[_],_,m)!==!1;);return m}function sp(m,E){for(var _=m==null?0:m.length;_--&&E(m[_],_,m)!==!1;);return m}function ya(m,E){for(var _=-1,N=m==null?0:m.length;++_<N;)if(!E(m[_],_,m))return!1;return!0}function Bt(m,E){for(var _=-1,N=m==null?0:m.length,U=0,oe=[];++_<N;){var Se=m[_];E(Se,_,m)&&(oe[U++]=Se)}return oe}function Or(m,E){var _=m==null?0:m.length;return!!_&&Ei(m,E,0)>-1}function Js(m,E,_){for(var N=-1,U=m==null?0:m.length;++N<U;)if(_(E,m[N]))return!0;return!1}function ge(m,E){for(var _=-1,N=m==null?0:m.length,U=Array(N);++_<N;)U[_]=E(m[_],_,m);return U}function Vt(m,E){for(var _=-1,N=E.length,U=m.length;++_<N;)m[U+_]=E[_];return m}function Ys(m,E,_,N){var U=-1,oe=m==null?0:m.length;for(N&&oe&&(_=m[++U]);++U<oe;)_=E(_,m[U],U,m);return _}function np(m,E,_,N){var U=m==null?0:m.length;for(N&&U&&(_=m[--U]);U--;)_=E(_,m[U],U,m);return _}function Zs(m,E){for(var _=-1,N=m==null?0:m.length;++_<N;)if(E(m[_],_,m))return!0;return!1}var op=Xs("length");function ap(m){return m.split("")}function cp(m){return m.match(yl)||[]}function ma(m,E,_){var N;return _(m,function(U,oe,Se){if(E(U,oe,Se))return N=oe,!1}),N}function Dr(m,E,_,N){for(var U=m.length,oe=_+(N?1:-1);N?oe--:++oe<U;)if(E(m[oe],oe,m))return oe;return-1}function Ei(m,E,_){return E===E?_p(m,E,_):Dr(m,va,_)}function hp(m,E,_,N){for(var U=_-1,oe=m.length;++U<oe;)if(N(m[U],E))return U;return-1}function va(m){return m!==m}function wa(m,E){var _=m==null?0:m.length;return _?tn(m,E)/_:Ge}function Xs(m){return function(E){return E==null?i:E[m]}}function en(m){return function(E){return m==null?i:m[E]}}function _a(m,E,_,N,U){return U(m,function(oe,Se,pe){_=N?(N=!1,oe):E(_,oe,Se,pe)}),_}function up(m,E){var _=m.length;for(m.sort(E);_--;)m[_]=m[_].value;return m}function tn(m,E){for(var _,N=-1,U=m.length;++N<U;){var oe=E(m[N]);oe!==i&&(_=_===i?oe:_+oe)}return _}function rn(m,E){for(var _=-1,N=Array(m);++_<m;)N[_]=E(_);return N}function lp(m,E){return ge(E,function(_){return[_,m[_]]})}function ba(m){return m&&m.slice(0,Sa(m)+1).replace(Us,"")}function Qe(m){return function(E){return m(E)}}function sn(m,E){return ge(E,function(_){return m[_]})}function Zi(m,E){return m.has(E)}function Ea(m,E){for(var _=-1,N=m.length;++_<N&&Ei(E,m[_],0)>-1;);return _}function Ia(m,E){for(var _=m.length;_--&&Ei(E,m[_],0)>-1;);return _}function pp(m,E){for(var _=m.length,N=0;_--;)m[_]===E&&++N;return N}var dp=en(Jl),fp=en(Yl);function gp(m){return"\\"+Xl[m]}function yp(m,E){return m==null?i:m[E]}function Ii(m){return Kl.test(m)}function mp(m){return Gl.test(m)}function vp(m){for(var E,_=[];!(E=m.next()).done;)_.push(E.value);return _}function nn(m){var E=-1,_=Array(m.size);return m.forEach(function(N,U){_[++E]=[U,N]}),_}function Pa(m,E){return function(_){return m(E(_))}}function Kt(m,E){for(var _=-1,N=m.length,U=0,oe=[];++_<N;){var Se=m[_];(Se===E||Se===A)&&(m[_]=A,oe[U++]=_)}return oe}function Tr(m){var E=-1,_=Array(m.size);return m.forEach(function(N){_[++E]=N}),_}function wp(m){var E=-1,_=Array(m.size);return m.forEach(function(N){_[++E]=[N,N]}),_}function _p(m,E,_){for(var N=_-1,U=m.length;++N<U;)if(m[N]===E)return N;return-1}function bp(m,E,_){for(var N=_+1;N--;)if(m[N]===E)return N;return N}function Pi(m){return Ii(m)?Ip(m):op(m)}function gt(m){return Ii(m)?Pp(m):ap(m)}function Sa(m){for(var E=m.length;E--&&pl.test(m.charAt(E)););return E}var Ep=en(Zl);function Ip(m){for(var E=Gs.lastIndex=0;Gs.test(m);)++E;return E}function Pp(m){return m.match(Gs)||[]}function Sp(m){return m.match(Vl)||[]}var Rp=function m(E){E=E==null?Ae:Si.defaults(Ae.Object(),E,Si.pick(Ae,Wl));var _=E.Array,N=E.Date,U=E.Error,oe=E.Function,Se=E.Math,pe=E.Object,on=E.RegExp,Cp=E.String,st=E.TypeError,qr=_.prototype,xp=oe.prototype,Ri=pe.prototype,Nr=E["__core-js_shared__"],Fr=xp.toString,he=Ri.hasOwnProperty,Ap=0,Ra=function(){var e=/[^.]+$/.exec(Nr&&Nr.keys&&Nr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),$r=Ri.toString,Op=Fr.call(pe),Dp=Ae._,Tp=on("^"+Fr.call(he).replace(ks,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jr=ha?E.Buffer:i,Gt=E.Symbol,Mr=E.Uint8Array,Ca=jr?jr.allocUnsafe:i,zr=Pa(pe.getPrototypeOf,pe),xa=pe.create,Aa=Ri.propertyIsEnumerable,Lr=qr.splice,Oa=Gt?Gt.isConcatSpreadable:i,Xi=Gt?Gt.iterator:i,ni=Gt?Gt.toStringTag:i,kr=function(){try{var e=ui(pe,"defineProperty");return e({},"",{}),e}catch{}}(),qp=E.clearTimeout!==Ae.clearTimeout&&E.clearTimeout,Np=N&&N.now!==Ae.Date.now&&N.now,Fp=E.setTimeout!==Ae.setTimeout&&E.setTimeout,Ur=Se.ceil,Hr=Se.floor,an=pe.getOwnPropertySymbols,$p=jr?jr.isBuffer:i,Da=E.isFinite,jp=qr.join,Mp=Pa(pe.keys,pe),Re=Se.max,qe=Se.min,zp=N.now,Lp=E.parseInt,Ta=Se.random,kp=qr.reverse,cn=ui(E,"DataView"),er=ui(E,"Map"),hn=ui(E,"Promise"),Ci=ui(E,"Set"),tr=ui(E,"WeakMap"),ir=ui(pe,"create"),Br=tr&&new tr,xi={},Up=li(cn),Hp=li(er),Bp=li(hn),Vp=li(Ci),Kp=li(tr),Vr=Gt?Gt.prototype:i,rr=Vr?Vr.valueOf:i,qa=Vr?Vr.toString:i;function p(e){if(_e(e)&&!B(e)&&!(e instanceof ee)){if(e instanceof nt)return e;if(he.call(e,"__wrapped__"))return Nc(e)}return new nt(e)}var Ai=function(){function e(){}return function(t){if(!ve(t))return{};if(xa)return xa(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function Kr(){}function nt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}p.templateSettings={escape:ol,evaluate:al,interpolate:Uo,variable:"",imports:{_:p}},p.prototype=Kr.prototype,p.prototype.constructor=p,nt.prototype=Ai(Kr.prototype),nt.prototype.constructor=nt;function ee(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Pe,this.__views__=[]}function Gp(){var e=new ee(this.__wrapped__);return e.__actions__=ke(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ke(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ke(this.__views__),e}function Wp(){if(this.__filtered__){var e=new ee(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Qp(){var e=this.__wrapped__.value(),t=this.__dir__,s=B(e),a=t<0,h=s?e.length:0,d=cf(0,h,this.__views__),g=d.start,y=d.end,v=y-g,I=a?y:g-1,S=this.__iteratees__,R=S.length,O=0,j=qe(v,this.__takeCount__);if(!s||!a&&h==v&&j==v)return rc(e,this.__actions__);var L=[];e:for(;v--&&O<j;){I+=t;for(var G=-1,k=e[I];++G<R;){var J=S[G],re=J.iteratee,Ze=J.type,ze=re(k);if(Ze==C)k=ze;else if(!ze){if(Ze==b)continue e;break e}}L[O++]=k}return L}ee.prototype=Ai(Kr.prototype),ee.prototype.constructor=ee;function oi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Jp(){this.__data__=ir?ir(null):{},this.size=0}function Yp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Zp(e){var t=this.__data__;if(ir){var s=t[e];return s===w?i:s}return he.call(t,e)?t[e]:i}function Xp(e){var t=this.__data__;return ir?t[e]!==i:he.call(t,e)}function ed(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=ir&&t===i?w:t,this}oi.prototype.clear=Jp,oi.prototype.delete=Yp,oi.prototype.get=Zp,oi.prototype.has=Xp,oi.prototype.set=ed;function xt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function td(){this.__data__=[],this.size=0}function id(e){var t=this.__data__,s=Gr(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Lr.call(t,s,1),--this.size,!0}function rd(e){var t=this.__data__,s=Gr(t,e);return s<0?i:t[s][1]}function sd(e){return Gr(this.__data__,e)>-1}function nd(e,t){var s=this.__data__,a=Gr(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}xt.prototype.clear=td,xt.prototype.delete=id,xt.prototype.get=rd,xt.prototype.has=sd,xt.prototype.set=nd;function At(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function od(){this.size=0,this.__data__={hash:new oi,map:new(er||xt),string:new oi}}function ad(e){var t=ns(this,e).delete(e);return this.size-=t?1:0,t}function cd(e){return ns(this,e).get(e)}function hd(e){return ns(this,e).has(e)}function ud(e,t){var s=ns(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}At.prototype.clear=od,At.prototype.delete=ad,At.prototype.get=cd,At.prototype.has=hd,At.prototype.set=ud;function ai(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new At;++t<s;)this.add(e[t])}function ld(e){return this.__data__.set(e,w),this}function pd(e){return this.__data__.has(e)}ai.prototype.add=ai.prototype.push=ld,ai.prototype.has=pd;function yt(e){var t=this.__data__=new xt(e);this.size=t.size}function dd(){this.__data__=new xt,this.size=0}function fd(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function gd(e){return this.__data__.get(e)}function yd(e){return this.__data__.has(e)}function md(e,t){var s=this.__data__;if(s instanceof xt){var a=s.__data__;if(!er||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new At(a)}return s.set(e,t),this.size=s.size,this}yt.prototype.clear=dd,yt.prototype.delete=fd,yt.prototype.get=gd,yt.prototype.has=yd,yt.prototype.set=md;function Na(e,t){var s=B(e),a=!s&&pi(e),h=!s&&!a&&Zt(e),d=!s&&!a&&!h&&qi(e),g=s||a||h||d,y=g?rn(e.length,Cp):[],v=y.length;for(var I in e)(t||he.call(e,I))&&!(g&&(I=="length"||h&&(I=="offset"||I=="parent")||d&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||qt(I,v)))&&y.push(I);return y}function Fa(e){var t=e.length;return t?e[_n(0,t-1)]:i}function vd(e,t){return os(ke(e),ci(t,0,e.length))}function wd(e){return os(ke(e))}function un(e,t,s){(s!==i&&!mt(e[t],s)||s===i&&!(t in e))&&Ot(e,t,s)}function sr(e,t,s){var a=e[t];(!(he.call(e,t)&&mt(a,s))||s===i&&!(t in e))&&Ot(e,t,s)}function Gr(e,t){for(var s=e.length;s--;)if(mt(e[s][0],t))return s;return-1}function _d(e,t,s,a){return Wt(e,function(h,d,g){t(a,h,s(h),g)}),a}function $a(e,t){return e&&Pt(t,Ce(t),e)}function bd(e,t){return e&&Pt(t,He(t),e)}function Ot(e,t,s){t=="__proto__"&&kr?kr(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function ln(e,t){for(var s=-1,a=t.length,h=_(a),d=e==null;++s<a;)h[s]=d?i:Vn(e,t[s]);return h}function ci(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function ot(e,t,s,a,h,d){var g,y=t&x,v=t&F,I=t&q;if(s&&(g=h?s(e,a,h,d):s(e)),g!==i)return g;if(!ve(e))return e;var S=B(e);if(S){if(g=uf(e),!y)return ke(e,g)}else{var R=Ne(e),O=R==Sr||R==Mo;if(Zt(e))return oc(e,y);if(R==Ct||R==Ht||O&&!h){if(g=v||O?{}:Sc(e),!y)return v?Zd(e,bd(g,e)):Yd(e,$a(g,e))}else{if(!de[R])return h?e:{};g=lf(e,R,y)}}d||(d=new yt);var j=d.get(e);if(j)return j;d.set(e,g),eh(e)?e.forEach(function(k){g.add(ot(k,t,s,k,e,d))}):Zc(e)&&e.forEach(function(k,J){g.set(J,ot(k,t,s,J,e,d))});var L=I?v?Dn:On:v?He:Ce,G=S?i:L(e);return rt(G||e,function(k,J){G&&(J=k,k=e[J]),sr(g,J,ot(k,t,s,J,e,d))}),g}function Ed(e){var t=Ce(e);return function(s){return ja(s,e,t)}}function ja(e,t,s){var a=s.length;if(e==null)return!a;for(e=pe(e);a--;){var h=s[a],d=t[h],g=e[h];if(g===i&&!(h in e)||!d(g))return!1}return!0}function Ma(e,t,s){if(typeof e!="function")throw new st(l);return lr(function(){e.apply(i,s)},t)}function nr(e,t,s,a){var h=-1,d=Or,g=!0,y=e.length,v=[],I=t.length;if(!y)return v;s&&(t=ge(t,Qe(s))),a?(d=Js,g=!1):t.length>=o&&(d=Zi,g=!1,t=new ai(t));e:for(;++h<y;){var S=e[h],R=s==null?S:s(S);if(S=a||S!==0?S:0,g&&R===R){for(var O=I;O--;)if(t[O]===R)continue e;v.push(S)}else d(t,R,a)||v.push(S)}return v}var Wt=lc(It),za=lc(dn,!0);function Id(e,t){var s=!0;return Wt(e,function(a,h,d){return s=!!t(a,h,d),s}),s}function Wr(e,t,s){for(var a=-1,h=e.length;++a<h;){var d=e[a],g=t(d);if(g!=null&&(y===i?g===g&&!Ye(g):s(g,y)))var y=g,v=d}return v}function Pd(e,t,s,a){var h=e.length;for(s=K(s),s<0&&(s=-s>h?0:h+s),a=a===i||a>h?h:K(a),a<0&&(a+=h),a=s>a?0:ih(a);s<a;)e[s++]=t;return e}function La(e,t){var s=[];return Wt(e,function(a,h,d){t(a,h,d)&&s.push(a)}),s}function Oe(e,t,s,a,h){var d=-1,g=e.length;for(s||(s=df),h||(h=[]);++d<g;){var y=e[d];t>0&&s(y)?t>1?Oe(y,t-1,s,a,h):Vt(h,y):a||(h[h.length]=y)}return h}var pn=pc(),ka=pc(!0);function It(e,t){return e&&pn(e,t,Ce)}function dn(e,t){return e&&ka(e,t,Ce)}function Qr(e,t){return Bt(t,function(s){return Nt(e[s])})}function hi(e,t){t=Jt(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[St(t[s++])];return s&&s==a?e:i}function Ua(e,t,s){var a=t(e);return B(e)?a:Vt(a,s(e))}function je(e){return e==null?e===i?Xu:Yu:ni&&ni in pe(e)?af(e):_f(e)}function fn(e,t){return e>t}function Sd(e,t){return e!=null&&he.call(e,t)}function Rd(e,t){return e!=null&&t in pe(e)}function Cd(e,t,s){return e>=qe(t,s)&&e<Re(t,s)}function gn(e,t,s){for(var a=s?Js:Or,h=e[0].length,d=e.length,g=d,y=_(d),v=1/0,I=[];g--;){var S=e[g];g&&t&&(S=ge(S,Qe(t))),v=qe(S.length,v),y[g]=!s&&(t||h>=120&&S.length>=120)?new ai(g&&S):i}S=e[0];var R=-1,O=y[0];e:for(;++R<h&&I.length<v;){var j=S[R],L=t?t(j):j;if(j=s||j!==0?j:0,!(O?Zi(O,L):a(I,L,s))){for(g=d;--g;){var G=y[g];if(!(G?Zi(G,L):a(e[g],L,s)))continue e}O&&O.push(L),I.push(j)}}return I}function xd(e,t,s,a){return It(e,function(h,d,g){t(a,s(h),d,g)}),a}function or(e,t,s){t=Jt(t,e),e=Ac(e,t);var a=e==null?e:e[St(ct(t))];return a==null?i:We(a,e,s)}function Ha(e){return _e(e)&&je(e)==Ht}function Ad(e){return _e(e)&&je(e)==Yi}function Od(e){return _e(e)&&je(e)==Ki}function ar(e,t,s,a,h){return e===t?!0:e==null||t==null||!_e(e)&&!_e(t)?e!==e&&t!==t:Dd(e,t,s,a,ar,h)}function Dd(e,t,s,a,h,d){var g=B(e),y=B(t),v=g?Ir:Ne(e),I=y?Ir:Ne(t);v=v==Ht?Ct:v,I=I==Ht?Ct:I;var S=v==Ct,R=I==Ct,O=v==I;if(O&&Zt(e)){if(!Zt(t))return!1;g=!0,S=!1}if(O&&!S)return d||(d=new yt),g||qi(e)?Ec(e,t,s,a,h,d):nf(e,t,v,s,a,h,d);if(!(s&D)){var j=S&&he.call(e,"__wrapped__"),L=R&&he.call(t,"__wrapped__");if(j||L){var G=j?e.value():e,k=L?t.value():t;return d||(d=new yt),h(G,k,s,a,d)}}return O?(d||(d=new yt),of(e,t,s,a,h,d)):!1}function Td(e){return _e(e)&&Ne(e)==dt}function yn(e,t,s,a){var h=s.length,d=h,g=!a;if(e==null)return!d;for(e=pe(e);h--;){var y=s[h];if(g&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++h<d;){y=s[h];var v=y[0],I=e[v],S=y[1];if(g&&y[2]){if(I===i&&!(v in e))return!1}else{var R=new yt;if(a)var O=a(I,S,v,e,t,R);if(!(O===i?ar(S,I,D|M,a,R):O))return!1}}return!0}function Ba(e){if(!ve(e)||gf(e))return!1;var t=Nt(e)?Tp:El;return t.test(li(e))}function qd(e){return _e(e)&&je(e)==Wi}function Nd(e){return _e(e)&&Ne(e)==ft}function Fd(e){return _e(e)&&ps(e.length)&&!!fe[je(e)]}function Va(e){return typeof e=="function"?e:e==null?Be:typeof e=="object"?B(e)?Wa(e[0],e[1]):Ga(e):dh(e)}function mn(e){if(!ur(e))return Mp(e);var t=[];for(var s in pe(e))he.call(e,s)&&s!="constructor"&&t.push(s);return t}function $d(e){if(!ve(e))return wf(e);var t=ur(e),s=[];for(var a in e)a=="constructor"&&(t||!he.call(e,a))||s.push(a);return s}function vn(e,t){return e<t}function Ka(e,t){var s=-1,a=Ue(e)?_(e.length):[];return Wt(e,function(h,d,g){a[++s]=t(h,d,g)}),a}function Ga(e){var t=qn(e);return t.length==1&&t[0][2]?Cc(t[0][0],t[0][1]):function(s){return s===e||yn(s,e,t)}}function Wa(e,t){return Fn(e)&&Rc(t)?Cc(St(e),t):function(s){var a=Vn(s,e);return a===i&&a===t?Kn(s,e):ar(t,a,D|M)}}function Jr(e,t,s,a,h){e!==t&&pn(t,function(d,g){if(h||(h=new yt),ve(d))jd(e,t,g,s,Jr,a,h);else{var y=a?a(jn(e,g),d,g+"",e,t,h):i;y===i&&(y=d),un(e,g,y)}},He)}function jd(e,t,s,a,h,d,g){var y=jn(e,s),v=jn(t,s),I=g.get(v);if(I){un(e,s,I);return}var S=d?d(y,v,s+"",e,t,g):i,R=S===i;if(R){var O=B(v),j=!O&&Zt(v),L=!O&&!j&&qi(v);S=v,O||j||L?B(y)?S=y:Ee(y)?S=ke(y):j?(R=!1,S=oc(v,!0)):L?(R=!1,S=ac(v,!0)):S=[]:pr(v)||pi(v)?(S=y,pi(y)?S=rh(y):(!ve(y)||Nt(y))&&(S=Sc(v))):R=!1}R&&(g.set(v,S),h(S,v,a,d,g),g.delete(v)),un(e,s,S)}function Qa(e,t){var s=e.length;if(s)return t+=t<0?s:0,qt(t,s)?e[t]:i}function Ja(e,t,s){t.length?t=ge(t,function(d){return B(d)?function(g){return hi(g,d.length===1?d[0]:d)}:d}):t=[Be];var a=-1;t=ge(t,Qe(z()));var h=Ka(e,function(d,g,y){var v=ge(t,function(I){return I(d)});return{criteria:v,index:++a,value:d}});return up(h,function(d,g){return Jd(d,g,s)})}function Md(e,t){return Ya(e,t,function(s,a){return Kn(e,a)})}function Ya(e,t,s){for(var a=-1,h=t.length,d={};++a<h;){var g=t[a],y=hi(e,g);s(y,g)&&cr(d,Jt(g,e),y)}return d}function zd(e){return function(t){return hi(t,e)}}function wn(e,t,s,a){var h=a?hp:Ei,d=-1,g=t.length,y=e;for(e===t&&(t=ke(t)),s&&(y=ge(e,Qe(s)));++d<g;)for(var v=0,I=t[d],S=s?s(I):I;(v=h(y,S,v,a))>-1;)y!==e&&Lr.call(y,v,1),Lr.call(e,v,1);return e}function Za(e,t){for(var s=e?t.length:0,a=s-1;s--;){var h=t[s];if(s==a||h!==d){var d=h;qt(h)?Lr.call(e,h,1):In(e,h)}}return e}function _n(e,t){return e+Hr(Ta()*(t-e+1))}function Ld(e,t,s,a){for(var h=-1,d=Re(Ur((t-e)/(s||1)),0),g=_(d);d--;)g[a?d:++h]=e,e+=s;return g}function bn(e,t){var s="";if(!e||t<1||t>ne)return s;do t%2&&(s+=e),t=Hr(t/2),t&&(e+=e);while(t);return s}function Q(e,t){return Mn(xc(e,t,Be),e+"")}function kd(e){return Fa(Ni(e))}function Ud(e,t){var s=Ni(e);return os(s,ci(t,0,s.length))}function cr(e,t,s,a){if(!ve(e))return e;t=Jt(t,e);for(var h=-1,d=t.length,g=d-1,y=e;y!=null&&++h<d;){var v=St(t[h]),I=s;if(v==="__proto__"||v==="constructor"||v==="prototype")return e;if(h!=g){var S=y[v];I=a?a(S,v,y):i,I===i&&(I=ve(S)?S:qt(t[h+1])?[]:{})}sr(y,v,I),y=y[v]}return e}var Xa=Br?function(e,t){return Br.set(e,t),e}:Be,Hd=kr?function(e,t){return kr(e,"toString",{configurable:!0,enumerable:!1,value:Wn(t),writable:!0})}:Be;function Bd(e){return os(Ni(e))}function at(e,t,s){var a=-1,h=e.length;t<0&&(t=-t>h?0:h+t),s=s>h?h:s,s<0&&(s+=h),h=t>s?0:s-t>>>0,t>>>=0;for(var d=_(h);++a<h;)d[a]=e[a+t];return d}function Vd(e,t){var s;return Wt(e,function(a,h,d){return s=t(a,h,d),!s}),!!s}function Yr(e,t,s){var a=0,h=e==null?a:e.length;if(typeof t=="number"&&t===t&&h<=Ds){for(;a<h;){var d=a+h>>>1,g=e[d];g!==null&&!Ye(g)&&(s?g<=t:g<t)?a=d+1:h=d}return h}return En(e,t,Be,s)}function En(e,t,s,a){var h=0,d=e==null?0:e.length;if(d===0)return 0;t=s(t);for(var g=t!==t,y=t===null,v=Ye(t),I=t===i;h<d;){var S=Hr((h+d)/2),R=s(e[S]),O=R!==i,j=R===null,L=R===R,G=Ye(R);if(g)var k=a||L;else I?k=L&&(a||O):y?k=L&&O&&(a||!j):v?k=L&&O&&!j&&(a||!G):j||G?k=!1:k=a?R<=t:R<t;k?h=S+1:d=S}return qe(d,Ut)}function ec(e,t){for(var s=-1,a=e.length,h=0,d=[];++s<a;){var g=e[s],y=t?t(g):g;if(!s||!mt(y,v)){var v=y;d[h++]=g===0?0:g}}return d}function tc(e){return typeof e=="number"?e:Ye(e)?Ge:+e}function Je(e){if(typeof e=="string")return e;if(B(e))return ge(e,Je)+"";if(Ye(e))return qa?qa.call(e):"";var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function Qt(e,t,s){var a=-1,h=Or,d=e.length,g=!0,y=[],v=y;if(s)g=!1,h=Js;else if(d>=o){var I=t?null:rf(e);if(I)return Tr(I);g=!1,h=Zi,v=new ai}else v=t?[]:y;e:for(;++a<d;){var S=e[a],R=t?t(S):S;if(S=s||S!==0?S:0,g&&R===R){for(var O=v.length;O--;)if(v[O]===R)continue e;t&&v.push(R),y.push(S)}else h(v,R,s)||(v!==y&&v.push(R),y.push(S))}return y}function In(e,t){return t=Jt(t,e),e=Ac(e,t),e==null||delete e[St(ct(t))]}function ic(e,t,s,a){return cr(e,t,s(hi(e,t)),a)}function Zr(e,t,s,a){for(var h=e.length,d=a?h:-1;(a?d--:++d<h)&&t(e[d],d,e););return s?at(e,a?0:d,a?d+1:h):at(e,a?d+1:0,a?h:d)}function rc(e,t){var s=e;return s instanceof ee&&(s=s.value()),Ys(t,function(a,h){return h.func.apply(h.thisArg,Vt([a],h.args))},s)}function Pn(e,t,s){var a=e.length;if(a<2)return a?Qt(e[0]):[];for(var h=-1,d=_(a);++h<a;)for(var g=e[h],y=-1;++y<a;)y!=h&&(d[h]=nr(d[h]||g,e[y],t,s));return Qt(Oe(d,1),t,s)}function sc(e,t,s){for(var a=-1,h=e.length,d=t.length,g={};++a<h;){var y=a<d?t[a]:i;s(g,e[a],y)}return g}function Sn(e){return Ee(e)?e:[]}function Rn(e){return typeof e=="function"?e:Be}function Jt(e,t){return B(e)?e:Fn(e,t)?[e]:qc(ae(e))}var Kd=Q;function Yt(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:at(e,t,s)}var nc=qp||function(e){return Ae.clearTimeout(e)};function oc(e,t){if(t)return e.slice();var s=e.length,a=Ca?Ca(s):new e.constructor(s);return e.copy(a),a}function Cn(e){var t=new e.constructor(e.byteLength);return new Mr(t).set(new Mr(e)),t}function Gd(e,t){var s=t?Cn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Wd(e){var t=new e.constructor(e.source,Ho.exec(e));return t.lastIndex=e.lastIndex,t}function Qd(e){return rr?pe(rr.call(e)):{}}function ac(e,t){var s=t?Cn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function cc(e,t){if(e!==t){var s=e!==i,a=e===null,h=e===e,d=Ye(e),g=t!==i,y=t===null,v=t===t,I=Ye(t);if(!y&&!I&&!d&&e>t||d&&g&&v&&!y&&!I||a&&g&&v||!s&&v||!h)return 1;if(!a&&!d&&!I&&e<t||I&&s&&h&&!a&&!d||y&&s&&h||!g&&h||!v)return-1}return 0}function Jd(e,t,s){for(var a=-1,h=e.criteria,d=t.criteria,g=h.length,y=s.length;++a<g;){var v=cc(h[a],d[a]);if(v){if(a>=y)return v;var I=s[a];return v*(I=="desc"?-1:1)}}return e.index-t.index}function hc(e,t,s,a){for(var h=-1,d=e.length,g=s.length,y=-1,v=t.length,I=Re(d-g,0),S=_(v+I),R=!a;++y<v;)S[y]=t[y];for(;++h<g;)(R||h<d)&&(S[s[h]]=e[h]);for(;I--;)S[y++]=e[h++];return S}function uc(e,t,s,a){for(var h=-1,d=e.length,g=-1,y=s.length,v=-1,I=t.length,S=Re(d-y,0),R=_(S+I),O=!a;++h<S;)R[h]=e[h];for(var j=h;++v<I;)R[j+v]=t[v];for(;++g<y;)(O||h<d)&&(R[j+s[g]]=e[h++]);return R}function ke(e,t){var s=-1,a=e.length;for(t||(t=_(a));++s<a;)t[s]=e[s];return t}function Pt(e,t,s,a){var h=!s;s||(s={});for(var d=-1,g=t.length;++d<g;){var y=t[d],v=a?a(s[y],e[y],y,s,e):i;v===i&&(v=e[y]),h?Ot(s,y,v):sr(s,y,v)}return s}function Yd(e,t){return Pt(e,Nn(e),t)}function Zd(e,t){return Pt(e,Ic(e),t)}function Xr(e,t){return function(s,a){var h=B(s)?rp:_d,d=t?t():{};return h(s,e,z(a,2),d)}}function Oi(e){return Q(function(t,s){var a=-1,h=s.length,d=h>1?s[h-1]:i,g=h>2?s[2]:i;for(d=e.length>3&&typeof d=="function"?(h--,d):i,g&&Me(s[0],s[1],g)&&(d=h<3?i:d,h=1),t=pe(t);++a<h;){var y=s[a];y&&e(t,y,a,d)}return t})}function lc(e,t){return function(s,a){if(s==null)return s;if(!Ue(s))return e(s,a);for(var h=s.length,d=t?h:-1,g=pe(s);(t?d--:++d<h)&&a(g[d],d,g)!==!1;);return s}}function pc(e){return function(t,s,a){for(var h=-1,d=pe(t),g=a(t),y=g.length;y--;){var v=g[e?y:++h];if(s(d[v],v,d)===!1)break}return t}}function Xd(e,t,s){var a=t&V,h=hr(e);function d(){var g=this&&this!==Ae&&this instanceof d?h:e;return g.apply(a?s:this,arguments)}return d}function dc(e){return function(t){t=ae(t);var s=Ii(t)?gt(t):i,a=s?s[0]:t.charAt(0),h=s?Yt(s,1).join(""):t.slice(1);return a[e]()+h}}function Di(e){return function(t){return Ys(lh(uh(t).replace(Hl,"")),e,"")}}function hr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=Ai(e.prototype),a=e.apply(s,t);return ve(a)?a:s}}function ef(e,t,s){var a=hr(e);function h(){for(var d=arguments.length,g=_(d),y=d,v=Ti(h);y--;)g[y]=arguments[y];var I=d<3&&g[0]!==v&&g[d-1]!==v?[]:Kt(g,v);if(d-=I.length,d<s)return vc(e,t,es,h.placeholder,i,g,I,i,i,s-d);var S=this&&this!==Ae&&this instanceof h?a:e;return We(S,this,g)}return h}function fc(e){return function(t,s,a){var h=pe(t);if(!Ue(t)){var d=z(s,3);t=Ce(t),s=function(y){return d(h[y],y,h)}}var g=e(t,s,a);return g>-1?h[d?t[g]:g]:i}}function gc(e){return Tt(function(t){var s=t.length,a=s,h=nt.prototype.thru;for(e&&t.reverse();a--;){var d=t[a];if(typeof d!="function")throw new st(l);if(h&&!g&&ss(d)=="wrapper")var g=new nt([],!0)}for(a=g?a:s;++a<s;){d=t[a];var y=ss(d),v=y=="wrapper"?Tn(d):i;v&&$n(v[0])&&v[1]==(le|te|X|ue)&&!v[4].length&&v[9]==1?g=g[ss(v[0])].apply(g,v[3]):g=d.length==1&&$n(d)?g[y]():g.thru(d)}return function(){var I=arguments,S=I[0];if(g&&I.length==1&&B(S))return g.plant(S).value();for(var R=0,O=s?t[R].apply(this,I):S;++R<s;)O=t[R].call(this,O);return O}})}function es(e,t,s,a,h,d,g,y,v,I){var S=t&le,R=t&V,O=t&W,j=t&(te|Z),L=t&Le,G=O?i:hr(e);function k(){for(var J=arguments.length,re=_(J),Ze=J;Ze--;)re[Ze]=arguments[Ze];if(j)var ze=Ti(k),Xe=pp(re,ze);if(a&&(re=hc(re,a,h,j)),d&&(re=uc(re,d,g,j)),J-=Xe,j&&J<I){var Ie=Kt(re,ze);return vc(e,t,es,k.placeholder,s,re,Ie,y,v,I-J)}var vt=R?s:this,$t=O?vt[e]:e;return J=re.length,y?re=bf(re,y):L&&J>1&&re.reverse(),S&&v<J&&(re.length=v),this&&this!==Ae&&this instanceof k&&($t=G||hr($t)),$t.apply(vt,re)}return k}function yc(e,t){return function(s,a){return xd(s,e,t(a),{})}}function ts(e,t){return function(s,a){var h;if(s===i&&a===i)return t;if(s!==i&&(h=s),a!==i){if(h===i)return a;typeof s=="string"||typeof a=="string"?(s=Je(s),a=Je(a)):(s=tc(s),a=tc(a)),h=e(s,a)}return h}}function xn(e){return Tt(function(t){return t=ge(t,Qe(z())),Q(function(s){var a=this;return e(t,function(h){return We(h,a,s)})})})}function is(e,t){t=t===i?" ":Je(t);var s=t.length;if(s<2)return s?bn(t,e):t;var a=bn(t,Ur(e/Pi(t)));return Ii(t)?Yt(gt(a),0,e).join(""):a.slice(0,e)}function tf(e,t,s,a){var h=t&V,d=hr(e);function g(){for(var y=-1,v=arguments.length,I=-1,S=a.length,R=_(S+v),O=this&&this!==Ae&&this instanceof g?d:e;++I<S;)R[I]=a[I];for(;v--;)R[I++]=arguments[++y];return We(O,h?s:this,R)}return g}function mc(e){return function(t,s,a){return a&&typeof a!="number"&&Me(t,s,a)&&(s=a=i),t=Ft(t),s===i?(s=t,t=0):s=Ft(s),a=a===i?t<s?1:-1:Ft(a),Ld(t,s,a,e)}}function rs(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=ht(t),s=ht(s)),e(t,s)}}function vc(e,t,s,a,h,d,g,y,v,I){var S=t&te,R=S?g:i,O=S?i:g,j=S?d:i,L=S?i:d;t|=S?X:me,t&=~(S?me:X),t&se||(t&=~(V|W));var G=[e,t,h,j,R,L,O,y,v,I],k=s.apply(i,G);return $n(e)&&Oc(k,G),k.placeholder=a,Dc(k,e,t)}function An(e){var t=Se[e];return function(s,a){if(s=ht(s),a=a==null?0:qe(K(a),292),a&&Da(s)){var h=(ae(s)+"e").split("e"),d=t(h[0]+"e"+(+h[1]+a));return h=(ae(d)+"e").split("e"),+(h[0]+"e"+(+h[1]-a))}return t(s)}}var rf=Ci&&1/Tr(new Ci([,-0]))[1]==ce?function(e){return new Ci(e)}:Yn;function wc(e){return function(t){var s=Ne(t);return s==dt?nn(t):s==ft?wp(t):lp(t,e(t))}}function Dt(e,t,s,a,h,d,g,y){var v=t&W;if(!v&&typeof e!="function")throw new st(l);var I=a?a.length:0;if(I||(t&=~(X|me),a=h=i),g=g===i?g:Re(K(g),0),y=y===i?y:K(y),I-=h?h.length:0,t&me){var S=a,R=h;a=h=i}var O=v?i:Tn(e),j=[e,t,s,a,h,S,R,d,g,y];if(O&&vf(j,O),e=j[0],t=j[1],s=j[2],a=j[3],h=j[4],y=j[9]=j[9]===i?v?0:e.length:Re(j[9]-I,0),!y&&t&(te|Z)&&(t&=~(te|Z)),!t||t==V)var L=Xd(e,t,s);else t==te||t==Z?L=ef(e,t,y):(t==X||t==(V|X))&&!h.length?L=tf(e,t,s,a):L=es.apply(i,j);var G=O?Xa:Oc;return Dc(G(L,j),e,t)}function _c(e,t,s,a){return e===i||mt(e,Ri[s])&&!he.call(a,s)?t:e}function bc(e,t,s,a,h,d){return ve(e)&&ve(t)&&(d.set(t,e),Jr(e,t,i,bc,d),d.delete(t)),e}function sf(e){return pr(e)?i:e}function Ec(e,t,s,a,h,d){var g=s&D,y=e.length,v=t.length;if(y!=v&&!(g&&v>y))return!1;var I=d.get(e),S=d.get(t);if(I&&S)return I==t&&S==e;var R=-1,O=!0,j=s&M?new ai:i;for(d.set(e,t),d.set(t,e);++R<y;){var L=e[R],G=t[R];if(a)var k=g?a(G,L,R,t,e,d):a(L,G,R,e,t,d);if(k!==i){if(k)continue;O=!1;break}if(j){if(!Zs(t,function(J,re){if(!Zi(j,re)&&(L===J||h(L,J,s,a,d)))return j.push(re)})){O=!1;break}}else if(!(L===G||h(L,G,s,a,d))){O=!1;break}}return d.delete(e),d.delete(t),O}function nf(e,t,s,a,h,d,g){switch(s){case _i:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Yi:return!(e.byteLength!=t.byteLength||!d(new Mr(e),new Mr(t)));case Vi:case Ki:case Gi:return mt(+e,+t);case Pr:return e.name==t.name&&e.message==t.message;case Wi:case Qi:return e==t+"";case dt:var y=nn;case ft:var v=a&D;if(y||(y=Tr),e.size!=t.size&&!v)return!1;var I=g.get(e);if(I)return I==t;a|=M,g.set(e,t);var S=Ec(y(e),y(t),a,h,d,g);return g.delete(e),S;case Rr:if(rr)return rr.call(e)==rr.call(t)}return!1}function of(e,t,s,a,h,d){var g=s&D,y=On(e),v=y.length,I=On(t),S=I.length;if(v!=S&&!g)return!1;for(var R=v;R--;){var O=y[R];if(!(g?O in t:he.call(t,O)))return!1}var j=d.get(e),L=d.get(t);if(j&&L)return j==t&&L==e;var G=!0;d.set(e,t),d.set(t,e);for(var k=g;++R<v;){O=y[R];var J=e[O],re=t[O];if(a)var Ze=g?a(re,J,O,t,e,d):a(J,re,O,e,t,d);if(!(Ze===i?J===re||h(J,re,s,a,d):Ze)){G=!1;break}k||(k=O=="constructor")}if(G&&!k){var ze=e.constructor,Xe=t.constructor;ze!=Xe&&"constructor"in e&&"constructor"in t&&!(typeof ze=="function"&&ze instanceof ze&&typeof Xe=="function"&&Xe instanceof Xe)&&(G=!1)}return d.delete(e),d.delete(t),G}function Tt(e){return Mn(xc(e,i,jc),e+"")}function On(e){return Ua(e,Ce,Nn)}function Dn(e){return Ua(e,He,Ic)}var Tn=Br?function(e){return Br.get(e)}:Yn;function ss(e){for(var t=e.name+"",s=xi[t],a=he.call(xi,t)?s.length:0;a--;){var h=s[a],d=h.func;if(d==null||d==e)return h.name}return t}function Ti(e){var t=he.call(p,"placeholder")?p:e;return t.placeholder}function z(){var e=p.iteratee||Qn;return e=e===Qn?Va:e,arguments.length?e(arguments[0],arguments[1]):e}function ns(e,t){var s=e.__data__;return ff(t)?s[typeof t=="string"?"string":"hash"]:s.map}function qn(e){for(var t=Ce(e),s=t.length;s--;){var a=t[s],h=e[a];t[s]=[a,h,Rc(h)]}return t}function ui(e,t){var s=yp(e,t);return Ba(s)?s:i}function af(e){var t=he.call(e,ni),s=e[ni];try{e[ni]=i;var a=!0}catch{}var h=$r.call(e);return a&&(t?e[ni]=s:delete e[ni]),h}var Nn=an?function(e){return e==null?[]:(e=pe(e),Bt(an(e),function(t){return Aa.call(e,t)}))}:Zn,Ic=an?function(e){for(var t=[];e;)Vt(t,Nn(e)),e=zr(e);return t}:Zn,Ne=je;(cn&&Ne(new cn(new ArrayBuffer(1)))!=_i||er&&Ne(new er)!=dt||hn&&Ne(hn.resolve())!=zo||Ci&&Ne(new Ci)!=ft||tr&&Ne(new tr)!=Ji)&&(Ne=function(e){var t=je(e),s=t==Ct?e.constructor:i,a=s?li(s):"";if(a)switch(a){case Up:return _i;case Hp:return dt;case Bp:return zo;case Vp:return ft;case Kp:return Ji}return t});function cf(e,t,s){for(var a=-1,h=s.length;++a<h;){var d=s[a],g=d.size;switch(d.type){case"drop":e+=g;break;case"dropRight":t-=g;break;case"take":t=qe(t,e+g);break;case"takeRight":e=Re(e,t-g);break}}return{start:e,end:t}}function hf(e){var t=e.match(fl);return t?t[1].split(gl):[]}function Pc(e,t,s){t=Jt(t,e);for(var a=-1,h=t.length,d=!1;++a<h;){var g=St(t[a]);if(!(d=e!=null&&s(e,g)))break;e=e[g]}return d||++a!=h?d:(h=e==null?0:e.length,!!h&&ps(h)&&qt(g,h)&&(B(e)||pi(e)))}function uf(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&he.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Sc(e){return typeof e.constructor=="function"&&!ur(e)?Ai(zr(e)):{}}function lf(e,t,s){var a=e.constructor;switch(t){case Yi:return Cn(e);case Vi:case Ki:return new a(+e);case _i:return Gd(e,s);case Ts:case qs:case Ns:case Fs:case $s:case js:case Ms:case zs:case Ls:return ac(e,s);case dt:return new a;case Gi:case Qi:return new a(e);case Wi:return Wd(e);case ft:return new a;case Rr:return Qd(e)}}function pf(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(dl,`{
/* [wrapped with `+t+`] */
`)}function df(e){return B(e)||pi(e)||!!(Oa&&e&&e[Oa])}function qt(e,t){var s=typeof e;return t=t??ne,!!t&&(s=="number"||s!="symbol"&&Pl.test(e))&&e>-1&&e%1==0&&e<t}function Me(e,t,s){if(!ve(s))return!1;var a=typeof t;return(a=="number"?Ue(s)&&qt(t,s.length):a=="string"&&t in s)?mt(s[t],e):!1}function Fn(e,t){if(B(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Ye(e)?!0:hl.test(e)||!cl.test(e)||t!=null&&e in pe(t)}function ff(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function $n(e){var t=ss(e),s=p[t];if(typeof s!="function"||!(t in ee.prototype))return!1;if(e===s)return!0;var a=Tn(s);return!!a&&e===a[0]}function gf(e){return!!Ra&&Ra in e}var yf=Nr?Nt:Xn;function ur(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||Ri;return e===s}function Rc(e){return e===e&&!ve(e)}function Cc(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in pe(s))}}function mf(e){var t=us(e,function(a){return s.size===P&&s.clear(),a}),s=t.cache;return t}function vf(e,t){var s=e[1],a=t[1],h=s|a,d=h<(V|W|le),g=a==le&&s==te||a==le&&s==ue&&e[7].length<=t[8]||a==(le|ue)&&t[7].length<=t[8]&&s==te;if(!(d||g))return e;a&V&&(e[2]=t[2],h|=s&V?0:se);var y=t[3];if(y){var v=e[3];e[3]=v?hc(v,y,t[4]):y,e[4]=v?Kt(e[3],A):t[4]}return y=t[5],y&&(v=e[5],e[5]=v?uc(v,y,t[6]):y,e[6]=v?Kt(e[5],A):t[6]),y=t[7],y&&(e[7]=y),a&le&&(e[8]=e[8]==null?t[8]:qe(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=h,e}function wf(e){var t=[];if(e!=null)for(var s in pe(e))t.push(s);return t}function _f(e){return $r.call(e)}function xc(e,t,s){return t=Re(t===i?e.length-1:t,0),function(){for(var a=arguments,h=-1,d=Re(a.length-t,0),g=_(d);++h<d;)g[h]=a[t+h];h=-1;for(var y=_(t+1);++h<t;)y[h]=a[h];return y[t]=s(g),We(e,this,y)}}function Ac(e,t){return t.length<2?e:hi(e,at(t,0,-1))}function bf(e,t){for(var s=e.length,a=qe(t.length,s),h=ke(e);a--;){var d=t[a];e[a]=qt(d,s)?h[d]:i}return e}function jn(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Oc=Tc(Xa),lr=Fp||function(e,t){return Ae.setTimeout(e,t)},Mn=Tc(Hd);function Dc(e,t,s){var a=t+"";return Mn(e,pf(a,Ef(hf(a),s)))}function Tc(e){var t=0,s=0;return function(){var a=zp(),h=be-(a-s);if(s=a,h>0){if(++t>=$e)return arguments[0]}else t=0;return e.apply(i,arguments)}}function os(e,t){var s=-1,a=e.length,h=a-1;for(t=t===i?a:t;++s<t;){var d=_n(s,h),g=e[d];e[d]=e[s],e[s]=g}return e.length=t,e}var qc=mf(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ul,function(s,a,h,d){t.push(h?d.replace(vl,"$1"):a||s)}),t});function St(e){if(typeof e=="string"||Ye(e))return e;var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function li(e){if(e!=null){try{return Fr.call(e)}catch{}try{return e+""}catch{}}return""}function Ef(e,t){return rt(Bi,function(s){var a="_."+s[0];t&s[1]&&!Or(e,a)&&e.push(a)}),e.sort()}function Nc(e){if(e instanceof ee)return e.clone();var t=new nt(e.__wrapped__,e.__chain__);return t.__actions__=ke(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function If(e,t,s){(s?Me(e,t,s):t===i)?t=1:t=Re(K(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var h=0,d=0,g=_(Ur(a/t));h<a;)g[d++]=at(e,h,h+=t);return g}function Pf(e){for(var t=-1,s=e==null?0:e.length,a=0,h=[];++t<s;){var d=e[t];d&&(h[a++]=d)}return h}function Sf(){var e=arguments.length;if(!e)return[];for(var t=_(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return Vt(B(s)?ke(s):[s],Oe(t,1))}var Rf=Q(function(e,t){return Ee(e)?nr(e,Oe(t,1,Ee,!0)):[]}),Cf=Q(function(e,t){var s=ct(t);return Ee(s)&&(s=i),Ee(e)?nr(e,Oe(t,1,Ee,!0),z(s,2)):[]}),xf=Q(function(e,t){var s=ct(t);return Ee(s)&&(s=i),Ee(e)?nr(e,Oe(t,1,Ee,!0),i,s):[]});function Af(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:K(t),at(e,t<0?0:t,a)):[]}function Of(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:K(t),t=a-t,at(e,0,t<0?0:t)):[]}function Df(e,t){return e&&e.length?Zr(e,z(t,3),!0,!0):[]}function Tf(e,t){return e&&e.length?Zr(e,z(t,3),!0):[]}function qf(e,t,s,a){var h=e==null?0:e.length;return h?(s&&typeof s!="number"&&Me(e,t,s)&&(s=0,a=h),Pd(e,t,s,a)):[]}function Fc(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:K(s);return h<0&&(h=Re(a+h,0)),Dr(e,z(t,3),h)}function $c(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a-1;return s!==i&&(h=K(s),h=s<0?Re(a+h,0):qe(h,a-1)),Dr(e,z(t,3),h,!0)}function jc(e){var t=e==null?0:e.length;return t?Oe(e,1):[]}function Nf(e){var t=e==null?0:e.length;return t?Oe(e,ce):[]}function Ff(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:K(t),Oe(e,t)):[]}function $f(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var h=e[t];a[h[0]]=h[1]}return a}function Mc(e){return e&&e.length?e[0]:i}function jf(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:K(s);return h<0&&(h=Re(a+h,0)),Ei(e,t,h)}function Mf(e){var t=e==null?0:e.length;return t?at(e,0,-1):[]}var zf=Q(function(e){var t=ge(e,Sn);return t.length&&t[0]===e[0]?gn(t):[]}),Lf=Q(function(e){var t=ct(e),s=ge(e,Sn);return t===ct(s)?t=i:s.pop(),s.length&&s[0]===e[0]?gn(s,z(t,2)):[]}),kf=Q(function(e){var t=ct(e),s=ge(e,Sn);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?gn(s,i,t):[]});function Uf(e,t){return e==null?"":jp.call(e,t)}function ct(e){var t=e==null?0:e.length;return t?e[t-1]:i}function Hf(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a;return s!==i&&(h=K(s),h=h<0?Re(a+h,0):qe(h,a-1)),t===t?bp(e,t,h):Dr(e,va,h,!0)}function Bf(e,t){return e&&e.length?Qa(e,K(t)):i}var Vf=Q(zc);function zc(e,t){return e&&e.length&&t&&t.length?wn(e,t):e}function Kf(e,t,s){return e&&e.length&&t&&t.length?wn(e,t,z(s,2)):e}function Gf(e,t,s){return e&&e.length&&t&&t.length?wn(e,t,i,s):e}var Wf=Tt(function(e,t){var s=e==null?0:e.length,a=ln(e,t);return Za(e,ge(t,function(h){return qt(h,s)?+h:h}).sort(cc)),a});function Qf(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,h=[],d=e.length;for(t=z(t,3);++a<d;){var g=e[a];t(g,a,e)&&(s.push(g),h.push(a))}return Za(e,h),s}function zn(e){return e==null?e:kp.call(e)}function Jf(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Me(e,t,s)?(t=0,s=a):(t=t==null?0:K(t),s=s===i?a:K(s)),at(e,t,s)):[]}function Yf(e,t){return Yr(e,t)}function Zf(e,t,s){return En(e,t,z(s,2))}function Xf(e,t){var s=e==null?0:e.length;if(s){var a=Yr(e,t);if(a<s&&mt(e[a],t))return a}return-1}function eg(e,t){return Yr(e,t,!0)}function tg(e,t,s){return En(e,t,z(s,2),!0)}function ig(e,t){var s=e==null?0:e.length;if(s){var a=Yr(e,t,!0)-1;if(mt(e[a],t))return a}return-1}function rg(e){return e&&e.length?ec(e):[]}function sg(e,t){return e&&e.length?ec(e,z(t,2)):[]}function ng(e){var t=e==null?0:e.length;return t?at(e,1,t):[]}function og(e,t,s){return e&&e.length?(t=s||t===i?1:K(t),at(e,0,t<0?0:t)):[]}function ag(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:K(t),t=a-t,at(e,t<0?0:t,a)):[]}function cg(e,t){return e&&e.length?Zr(e,z(t,3),!1,!0):[]}function hg(e,t){return e&&e.length?Zr(e,z(t,3)):[]}var ug=Q(function(e){return Qt(Oe(e,1,Ee,!0))}),lg=Q(function(e){var t=ct(e);return Ee(t)&&(t=i),Qt(Oe(e,1,Ee,!0),z(t,2))}),pg=Q(function(e){var t=ct(e);return t=typeof t=="function"?t:i,Qt(Oe(e,1,Ee,!0),i,t)});function dg(e){return e&&e.length?Qt(e):[]}function fg(e,t){return e&&e.length?Qt(e,z(t,2)):[]}function gg(e,t){return t=typeof t=="function"?t:i,e&&e.length?Qt(e,i,t):[]}function Ln(e){if(!(e&&e.length))return[];var t=0;return e=Bt(e,function(s){if(Ee(s))return t=Re(s.length,t),!0}),rn(t,function(s){return ge(e,Xs(s))})}function Lc(e,t){if(!(e&&e.length))return[];var s=Ln(e);return t==null?s:ge(s,function(a){return We(t,i,a)})}var yg=Q(function(e,t){return Ee(e)?nr(e,t):[]}),mg=Q(function(e){return Pn(Bt(e,Ee))}),vg=Q(function(e){var t=ct(e);return Ee(t)&&(t=i),Pn(Bt(e,Ee),z(t,2))}),wg=Q(function(e){var t=ct(e);return t=typeof t=="function"?t:i,Pn(Bt(e,Ee),i,t)}),_g=Q(Ln);function bg(e,t){return sc(e||[],t||[],sr)}function Eg(e,t){return sc(e||[],t||[],cr)}var Ig=Q(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,Lc(e,s)});function kc(e){var t=p(e);return t.__chain__=!0,t}function Pg(e,t){return t(e),e}function as(e,t){return t(e)}var Sg=Tt(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,h=function(d){return ln(d,e)};return t>1||this.__actions__.length||!(a instanceof ee)||!qt(s)?this.thru(h):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:as,args:[h],thisArg:i}),new nt(a,this.__chain__).thru(function(d){return t&&!d.length&&d.push(i),d}))});function Rg(){return kc(this)}function Cg(){return new nt(this.value(),this.__chain__)}function xg(){this.__values__===i&&(this.__values__=th(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function Ag(){return this}function Og(e){for(var t,s=this;s instanceof Kr;){var a=Nc(s);a.__index__=0,a.__values__=i,t?h.__wrapped__=a:t=a;var h=a;s=s.__wrapped__}return h.__wrapped__=e,t}function Dg(){var e=this.__wrapped__;if(e instanceof ee){var t=e;return this.__actions__.length&&(t=new ee(this)),t=t.reverse(),t.__actions__.push({func:as,args:[zn],thisArg:i}),new nt(t,this.__chain__)}return this.thru(zn)}function Tg(){return rc(this.__wrapped__,this.__actions__)}var qg=Xr(function(e,t,s){he.call(e,s)?++e[s]:Ot(e,s,1)});function Ng(e,t,s){var a=B(e)?ya:Id;return s&&Me(e,t,s)&&(t=i),a(e,z(t,3))}function Fg(e,t){var s=B(e)?Bt:La;return s(e,z(t,3))}var $g=fc(Fc),jg=fc($c);function Mg(e,t){return Oe(cs(e,t),1)}function zg(e,t){return Oe(cs(e,t),ce)}function Lg(e,t,s){return s=s===i?1:K(s),Oe(cs(e,t),s)}function Uc(e,t){var s=B(e)?rt:Wt;return s(e,z(t,3))}function Hc(e,t){var s=B(e)?sp:za;return s(e,z(t,3))}var kg=Xr(function(e,t,s){he.call(e,s)?e[s].push(t):Ot(e,s,[t])});function Ug(e,t,s,a){e=Ue(e)?e:Ni(e),s=s&&!a?K(s):0;var h=e.length;return s<0&&(s=Re(h+s,0)),ds(e)?s<=h&&e.indexOf(t,s)>-1:!!h&&Ei(e,t,s)>-1}var Hg=Q(function(e,t,s){var a=-1,h=typeof t=="function",d=Ue(e)?_(e.length):[];return Wt(e,function(g){d[++a]=h?We(t,g,s):or(g,t,s)}),d}),Bg=Xr(function(e,t,s){Ot(e,s,t)});function cs(e,t){var s=B(e)?ge:Ka;return s(e,z(t,3))}function Vg(e,t,s,a){return e==null?[]:(B(t)||(t=t==null?[]:[t]),s=a?i:s,B(s)||(s=s==null?[]:[s]),Ja(e,t,s))}var Kg=Xr(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Gg(e,t,s){var a=B(e)?Ys:_a,h=arguments.length<3;return a(e,z(t,4),s,h,Wt)}function Wg(e,t,s){var a=B(e)?np:_a,h=arguments.length<3;return a(e,z(t,4),s,h,za)}function Qg(e,t){var s=B(e)?Bt:La;return s(e,ls(z(t,3)))}function Jg(e){var t=B(e)?Fa:kd;return t(e)}function Yg(e,t,s){(s?Me(e,t,s):t===i)?t=1:t=K(t);var a=B(e)?vd:Ud;return a(e,t)}function Zg(e){var t=B(e)?wd:Bd;return t(e)}function Xg(e){if(e==null)return 0;if(Ue(e))return ds(e)?Pi(e):e.length;var t=Ne(e);return t==dt||t==ft?e.size:mn(e).length}function ey(e,t,s){var a=B(e)?Zs:Vd;return s&&Me(e,t,s)&&(t=i),a(e,z(t,3))}var ty=Q(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Me(e,t[0],t[1])?t=[]:s>2&&Me(t[0],t[1],t[2])&&(t=[t[0]]),Ja(e,Oe(t,1),[])}),hs=Np||function(){return Ae.Date.now()};function iy(e,t){if(typeof t!="function")throw new st(l);return e=K(e),function(){if(--e<1)return t.apply(this,arguments)}}function Bc(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Dt(e,le,i,i,i,i,t)}function Vc(e,t){var s;if(typeof t!="function")throw new st(l);return e=K(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var kn=Q(function(e,t,s){var a=V;if(s.length){var h=Kt(s,Ti(kn));a|=X}return Dt(e,a,t,s,h)}),Kc=Q(function(e,t,s){var a=V|W;if(s.length){var h=Kt(s,Ti(Kc));a|=X}return Dt(t,a,e,s,h)});function Gc(e,t,s){t=s?i:t;var a=Dt(e,te,i,i,i,i,i,t);return a.placeholder=Gc.placeholder,a}function Wc(e,t,s){t=s?i:t;var a=Dt(e,Z,i,i,i,i,i,t);return a.placeholder=Wc.placeholder,a}function Qc(e,t,s){var a,h,d,g,y,v,I=0,S=!1,R=!1,O=!0;if(typeof e!="function")throw new st(l);t=ht(t)||0,ve(s)&&(S=!!s.leading,R="maxWait"in s,d=R?Re(ht(s.maxWait)||0,t):d,O="trailing"in s?!!s.trailing:O);function j(Ie){var vt=a,$t=h;return a=h=i,I=Ie,g=e.apply($t,vt),g}function L(Ie){return I=Ie,y=lr(J,t),S?j(Ie):g}function G(Ie){var vt=Ie-v,$t=Ie-I,fh=t-vt;return R?qe(fh,d-$t):fh}function k(Ie){var vt=Ie-v,$t=Ie-I;return v===i||vt>=t||vt<0||R&&$t>=d}function J(){var Ie=hs();if(k(Ie))return re(Ie);y=lr(J,G(Ie))}function re(Ie){return y=i,O&&a?j(Ie):(a=h=i,g)}function Ze(){y!==i&&nc(y),I=0,a=v=h=y=i}function ze(){return y===i?g:re(hs())}function Xe(){var Ie=hs(),vt=k(Ie);if(a=arguments,h=this,v=Ie,vt){if(y===i)return L(v);if(R)return nc(y),y=lr(J,t),j(v)}return y===i&&(y=lr(J,t)),g}return Xe.cancel=Ze,Xe.flush=ze,Xe}var ry=Q(function(e,t){return Ma(e,1,t)}),sy=Q(function(e,t,s){return Ma(e,ht(t)||0,s)});function ny(e){return Dt(e,Le)}function us(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new st(l);var s=function(){var a=arguments,h=t?t.apply(this,a):a[0],d=s.cache;if(d.has(h))return d.get(h);var g=e.apply(this,a);return s.cache=d.set(h,g)||d,g};return s.cache=new(us.Cache||At),s}us.Cache=At;function ls(e){if(typeof e!="function")throw new st(l);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function oy(e){return Vc(2,e)}var ay=Kd(function(e,t){t=t.length==1&&B(t[0])?ge(t[0],Qe(z())):ge(Oe(t,1),Qe(z()));var s=t.length;return Q(function(a){for(var h=-1,d=qe(a.length,s);++h<d;)a[h]=t[h].call(this,a[h]);return We(e,this,a)})}),Un=Q(function(e,t){var s=Kt(t,Ti(Un));return Dt(e,X,i,t,s)}),Jc=Q(function(e,t){var s=Kt(t,Ti(Jc));return Dt(e,me,i,t,s)}),cy=Tt(function(e,t){return Dt(e,ue,i,i,i,t)});function hy(e,t){if(typeof e!="function")throw new st(l);return t=t===i?t:K(t),Q(e,t)}function uy(e,t){if(typeof e!="function")throw new st(l);return t=t==null?0:Re(K(t),0),Q(function(s){var a=s[t],h=Yt(s,0,t);return a&&Vt(h,a),We(e,this,h)})}function ly(e,t,s){var a=!0,h=!0;if(typeof e!="function")throw new st(l);return ve(s)&&(a="leading"in s?!!s.leading:a,h="trailing"in s?!!s.trailing:h),Qc(e,t,{leading:a,maxWait:t,trailing:h})}function py(e){return Bc(e,1)}function dy(e,t){return Un(Rn(t),e)}function fy(){if(!arguments.length)return[];var e=arguments[0];return B(e)?e:[e]}function gy(e){return ot(e,q)}function yy(e,t){return t=typeof t=="function"?t:i,ot(e,q,t)}function my(e){return ot(e,x|q)}function vy(e,t){return t=typeof t=="function"?t:i,ot(e,x|q,t)}function wy(e,t){return t==null||ja(e,t,Ce(t))}function mt(e,t){return e===t||e!==e&&t!==t}var _y=rs(fn),by=rs(function(e,t){return e>=t}),pi=Ha(function(){return arguments}())?Ha:function(e){return _e(e)&&he.call(e,"callee")&&!Aa.call(e,"callee")},B=_.isArray,Ey=ua?Qe(ua):Ad;function Ue(e){return e!=null&&ps(e.length)&&!Nt(e)}function Ee(e){return _e(e)&&Ue(e)}function Iy(e){return e===!0||e===!1||_e(e)&&je(e)==Vi}var Zt=$p||Xn,Py=la?Qe(la):Od;function Sy(e){return _e(e)&&e.nodeType===1&&!pr(e)}function Ry(e){if(e==null)return!0;if(Ue(e)&&(B(e)||typeof e=="string"||typeof e.splice=="function"||Zt(e)||qi(e)||pi(e)))return!e.length;var t=Ne(e);if(t==dt||t==ft)return!e.size;if(ur(e))return!mn(e).length;for(var s in e)if(he.call(e,s))return!1;return!0}function Cy(e,t){return ar(e,t)}function xy(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?ar(e,t,i,s):!!a}function Hn(e){if(!_e(e))return!1;var t=je(e);return t==Pr||t==Ju||typeof e.message=="string"&&typeof e.name=="string"&&!pr(e)}function Ay(e){return typeof e=="number"&&Da(e)}function Nt(e){if(!ve(e))return!1;var t=je(e);return t==Sr||t==Mo||t==Qu||t==Zu}function Yc(e){return typeof e=="number"&&e==K(e)}function ps(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ne}function ve(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function _e(e){return e!=null&&typeof e=="object"}var Zc=pa?Qe(pa):Td;function Oy(e,t){return e===t||yn(e,t,qn(t))}function Dy(e,t,s){return s=typeof s=="function"?s:i,yn(e,t,qn(t),s)}function Ty(e){return Xc(e)&&e!=+e}function qy(e){if(yf(e))throw new U(c);return Ba(e)}function Ny(e){return e===null}function Fy(e){return e==null}function Xc(e){return typeof e=="number"||_e(e)&&je(e)==Gi}function pr(e){if(!_e(e)||je(e)!=Ct)return!1;var t=zr(e);if(t===null)return!0;var s=he.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Fr.call(s)==Op}var Bn=da?Qe(da):qd;function $y(e){return Yc(e)&&e>=-ne&&e<=ne}var eh=fa?Qe(fa):Nd;function ds(e){return typeof e=="string"||!B(e)&&_e(e)&&je(e)==Qi}function Ye(e){return typeof e=="symbol"||_e(e)&&je(e)==Rr}var qi=ga?Qe(ga):Fd;function jy(e){return e===i}function My(e){return _e(e)&&Ne(e)==Ji}function zy(e){return _e(e)&&je(e)==el}var Ly=rs(vn),ky=rs(function(e,t){return e<=t});function th(e){if(!e)return[];if(Ue(e))return ds(e)?gt(e):ke(e);if(Xi&&e[Xi])return vp(e[Xi]());var t=Ne(e),s=t==dt?nn:t==ft?Tr:Ni;return s(e)}function Ft(e){if(!e)return e===0?e:0;if(e=ht(e),e===ce||e===-ce){var t=e<0?-1:1;return t*ie}return e===e?e:0}function K(e){var t=Ft(e),s=t%1;return t===t?s?t-s:t:0}function ih(e){return e?ci(K(e),0,Pe):0}function ht(e){if(typeof e=="number")return e;if(Ye(e))return Ge;if(ve(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ve(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ba(e);var s=bl.test(e);return s||Il.test(e)?tp(e.slice(2),s?2:8):_l.test(e)?Ge:+e}function rh(e){return Pt(e,He(e))}function Uy(e){return e?ci(K(e),-ne,ne):e===0?e:0}function ae(e){return e==null?"":Je(e)}var Hy=Oi(function(e,t){if(ur(t)||Ue(t)){Pt(t,Ce(t),e);return}for(var s in t)he.call(t,s)&&sr(e,s,t[s])}),sh=Oi(function(e,t){Pt(t,He(t),e)}),fs=Oi(function(e,t,s,a){Pt(t,He(t),e,a)}),By=Oi(function(e,t,s,a){Pt(t,Ce(t),e,a)}),Vy=Tt(ln);function Ky(e,t){var s=Ai(e);return t==null?s:$a(s,t)}var Gy=Q(function(e,t){e=pe(e);var s=-1,a=t.length,h=a>2?t[2]:i;for(h&&Me(t[0],t[1],h)&&(a=1);++s<a;)for(var d=t[s],g=He(d),y=-1,v=g.length;++y<v;){var I=g[y],S=e[I];(S===i||mt(S,Ri[I])&&!he.call(e,I))&&(e[I]=d[I])}return e}),Wy=Q(function(e){return e.push(i,bc),We(nh,i,e)});function Qy(e,t){return ma(e,z(t,3),It)}function Jy(e,t){return ma(e,z(t,3),dn)}function Yy(e,t){return e==null?e:pn(e,z(t,3),He)}function Zy(e,t){return e==null?e:ka(e,z(t,3),He)}function Xy(e,t){return e&&It(e,z(t,3))}function em(e,t){return e&&dn(e,z(t,3))}function tm(e){return e==null?[]:Qr(e,Ce(e))}function im(e){return e==null?[]:Qr(e,He(e))}function Vn(e,t,s){var a=e==null?i:hi(e,t);return a===i?s:a}function rm(e,t){return e!=null&&Pc(e,t,Sd)}function Kn(e,t){return e!=null&&Pc(e,t,Rd)}var sm=yc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=$r.call(t)),e[t]=s},Wn(Be)),nm=yc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=$r.call(t)),he.call(e,t)?e[t].push(s):e[t]=[s]},z),om=Q(or);function Ce(e){return Ue(e)?Na(e):mn(e)}function He(e){return Ue(e)?Na(e,!0):$d(e)}function am(e,t){var s={};return t=z(t,3),It(e,function(a,h,d){Ot(s,t(a,h,d),a)}),s}function cm(e,t){var s={};return t=z(t,3),It(e,function(a,h,d){Ot(s,h,t(a,h,d))}),s}var hm=Oi(function(e,t,s){Jr(e,t,s)}),nh=Oi(function(e,t,s,a){Jr(e,t,s,a)}),um=Tt(function(e,t){var s={};if(e==null)return s;var a=!1;t=ge(t,function(d){return d=Jt(d,e),a||(a=d.length>1),d}),Pt(e,Dn(e),s),a&&(s=ot(s,x|F|q,sf));for(var h=t.length;h--;)In(s,t[h]);return s});function lm(e,t){return oh(e,ls(z(t)))}var pm=Tt(function(e,t){return e==null?{}:Md(e,t)});function oh(e,t){if(e==null)return{};var s=ge(Dn(e),function(a){return[a]});return t=z(t),Ya(e,s,function(a,h){return t(a,h[0])})}function dm(e,t,s){t=Jt(t,e);var a=-1,h=t.length;for(h||(h=1,e=i);++a<h;){var d=e==null?i:e[St(t[a])];d===i&&(a=h,d=s),e=Nt(d)?d.call(e):d}return e}function fm(e,t,s){return e==null?e:cr(e,t,s)}function gm(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:cr(e,t,s,a)}var ah=wc(Ce),ch=wc(He);function ym(e,t,s){var a=B(e),h=a||Zt(e)||qi(e);if(t=z(t,4),s==null){var d=e&&e.constructor;h?s=a?new d:[]:ve(e)?s=Nt(d)?Ai(zr(e)):{}:s={}}return(h?rt:It)(e,function(g,y,v){return t(s,g,y,v)}),s}function mm(e,t){return e==null?!0:In(e,t)}function vm(e,t,s){return e==null?e:ic(e,t,Rn(s))}function wm(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:ic(e,t,Rn(s),a)}function Ni(e){return e==null?[]:sn(e,Ce(e))}function _m(e){return e==null?[]:sn(e,He(e))}function bm(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=ht(s),s=s===s?s:0),t!==i&&(t=ht(t),t=t===t?t:0),ci(ht(e),t,s)}function Em(e,t,s){return t=Ft(t),s===i?(s=t,t=0):s=Ft(s),e=ht(e),Cd(e,t,s)}function Im(e,t,s){if(s&&typeof s!="boolean"&&Me(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Ft(e),t===i?(t=e,e=0):t=Ft(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var h=Ta();return qe(e+h*(t-e+ep("1e-"+((h+"").length-1))),t)}return _n(e,t)}var Pm=Di(function(e,t,s){return t=t.toLowerCase(),e+(s?hh(t):t)});function hh(e){return Gn(ae(e).toLowerCase())}function uh(e){return e=ae(e),e&&e.replace(Sl,dp).replace(Bl,"")}function Sm(e,t,s){e=ae(e),t=Je(t);var a=e.length;s=s===i?a:ci(K(s),0,a);var h=s;return s-=t.length,s>=0&&e.slice(s,h)==t}function Rm(e){return e=ae(e),e&&nl.test(e)?e.replace(ko,fp):e}function Cm(e){return e=ae(e),e&&ll.test(e)?e.replace(ks,"\\$&"):e}var xm=Di(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Am=Di(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Om=dc("toLowerCase");function Dm(e,t,s){e=ae(e),t=K(t);var a=t?Pi(e):0;if(!t||a>=t)return e;var h=(t-a)/2;return is(Hr(h),s)+e+is(Ur(h),s)}function Tm(e,t,s){e=ae(e),t=K(t);var a=t?Pi(e):0;return t&&a<t?e+is(t-a,s):e}function qm(e,t,s){e=ae(e),t=K(t);var a=t?Pi(e):0;return t&&a<t?is(t-a,s)+e:e}function Nm(e,t,s){return s||t==null?t=0:t&&(t=+t),Lp(ae(e).replace(Us,""),t||0)}function Fm(e,t,s){return(s?Me(e,t,s):t===i)?t=1:t=K(t),bn(ae(e),t)}function $m(){var e=arguments,t=ae(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var jm=Di(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Mm(e,t,s){return s&&typeof s!="number"&&Me(e,t,s)&&(t=s=i),s=s===i?Pe:s>>>0,s?(e=ae(e),e&&(typeof t=="string"||t!=null&&!Bn(t))&&(t=Je(t),!t&&Ii(e))?Yt(gt(e),0,s):e.split(t,s)):[]}var zm=Di(function(e,t,s){return e+(s?" ":"")+Gn(t)});function Lm(e,t,s){return e=ae(e),s=s==null?0:ci(K(s),0,e.length),t=Je(t),e.slice(s,s+t.length)==t}function km(e,t,s){var a=p.templateSettings;s&&Me(e,t,s)&&(t=i),e=ae(e),t=fs({},t,a,_c);var h=fs({},t.imports,a.imports,_c),d=Ce(h),g=sn(h,d),y,v,I=0,S=t.interpolate||Cr,R="__p += '",O=on((t.escape||Cr).source+"|"+S.source+"|"+(S===Uo?wl:Cr).source+"|"+(t.evaluate||Cr).source+"|$","g"),j="//# sourceURL="+(he.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ql+"]")+`
`;e.replace(O,function(k,J,re,Ze,ze,Xe){return re||(re=Ze),R+=e.slice(I,Xe).replace(Rl,gp),J&&(y=!0,R+=`' +
__e(`+J+`) +
'`),ze&&(v=!0,R+=`';
`+ze+`;
__p += '`),re&&(R+=`' +
((__t = (`+re+`)) == null ? '' : __t) +
'`),I=Xe+k.length,k}),R+=`';
`;var L=he.call(t,"variable")&&t.variable;if(!L)R=`with (obj) {
`+R+`
}
`;else if(ml.test(L))throw new U(f);R=(v?R.replace(tl,""):R).replace(il,"$1").replace(rl,"$1;"),R="function("+(L||"obj")+`) {
`+(L?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var G=ph(function(){return oe(d,j+"return "+R).apply(i,g)});if(G.source=R,Hn(G))throw G;return G}function Um(e){return ae(e).toLowerCase()}function Hm(e){return ae(e).toUpperCase()}function Bm(e,t,s){if(e=ae(e),e&&(s||t===i))return ba(e);if(!e||!(t=Je(t)))return e;var a=gt(e),h=gt(t),d=Ea(a,h),g=Ia(a,h)+1;return Yt(a,d,g).join("")}function Vm(e,t,s){if(e=ae(e),e&&(s||t===i))return e.slice(0,Sa(e)+1);if(!e||!(t=Je(t)))return e;var a=gt(e),h=Ia(a,gt(t))+1;return Yt(a,0,h).join("")}function Km(e,t,s){if(e=ae(e),e&&(s||t===i))return e.replace(Us,"");if(!e||!(t=Je(t)))return e;var a=gt(e),h=Ea(a,gt(t));return Yt(a,h).join("")}function Gm(e,t){var s=Et,a=Te;if(ve(t)){var h="separator"in t?t.separator:h;s="length"in t?K(t.length):s,a="omission"in t?Je(t.omission):a}e=ae(e);var d=e.length;if(Ii(e)){var g=gt(e);d=g.length}if(s>=d)return e;var y=s-Pi(a);if(y<1)return a;var v=g?Yt(g,0,y).join(""):e.slice(0,y);if(h===i)return v+a;if(g&&(y+=v.length-y),Bn(h)){if(e.slice(y).search(h)){var I,S=v;for(h.global||(h=on(h.source,ae(Ho.exec(h))+"g")),h.lastIndex=0;I=h.exec(S);)var R=I.index;v=v.slice(0,R===i?y:R)}}else if(e.indexOf(Je(h),y)!=y){var O=v.lastIndexOf(h);O>-1&&(v=v.slice(0,O))}return v+a}function Wm(e){return e=ae(e),e&&sl.test(e)?e.replace(Lo,Ep):e}var Qm=Di(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Gn=dc("toUpperCase");function lh(e,t,s){return e=ae(e),t=s?i:t,t===i?mp(e)?Sp(e):cp(e):e.match(t)||[]}var ph=Q(function(e,t){try{return We(e,i,t)}catch(s){return Hn(s)?s:new U(s)}}),Jm=Tt(function(e,t){return rt(t,function(s){s=St(s),Ot(e,s,kn(e[s],e))}),e});function Ym(e){var t=e==null?0:e.length,s=z();return e=t?ge(e,function(a){if(typeof a[1]!="function")throw new st(l);return[s(a[0]),a[1]]}):[],Q(function(a){for(var h=-1;++h<t;){var d=e[h];if(We(d[0],this,a))return We(d[1],this,a)}})}function Zm(e){return Ed(ot(e,x))}function Wn(e){return function(){return e}}function Xm(e,t){return e==null||e!==e?t:e}var ev=gc(),tv=gc(!0);function Be(e){return e}function Qn(e){return Va(typeof e=="function"?e:ot(e,x))}function iv(e){return Ga(ot(e,x))}function rv(e,t){return Wa(e,ot(t,x))}var sv=Q(function(e,t){return function(s){return or(s,e,t)}}),nv=Q(function(e,t){return function(s){return or(e,s,t)}});function Jn(e,t,s){var a=Ce(t),h=Qr(t,a);s==null&&!(ve(t)&&(h.length||!a.length))&&(s=t,t=e,e=this,h=Qr(t,Ce(t)));var d=!(ve(s)&&"chain"in s)||!!s.chain,g=Nt(e);return rt(h,function(y){var v=t[y];e[y]=v,g&&(e.prototype[y]=function(){var I=this.__chain__;if(d||I){var S=e(this.__wrapped__),R=S.__actions__=ke(this.__actions__);return R.push({func:v,args:arguments,thisArg:e}),S.__chain__=I,S}return v.apply(e,Vt([this.value()],arguments))})}),e}function ov(){return Ae._===this&&(Ae._=Dp),this}function Yn(){}function av(e){return e=K(e),Q(function(t){return Qa(t,e)})}var cv=xn(ge),hv=xn(ya),uv=xn(Zs);function dh(e){return Fn(e)?Xs(St(e)):zd(e)}function lv(e){return function(t){return e==null?i:hi(e,t)}}var pv=mc(),dv=mc(!0);function Zn(){return[]}function Xn(){return!1}function fv(){return{}}function gv(){return""}function yv(){return!0}function mv(e,t){if(e=K(e),e<1||e>ne)return[];var s=Pe,a=qe(e,Pe);t=z(t),e-=Pe;for(var h=rn(a,t);++s<e;)t(s);return h}function vv(e){return B(e)?ge(e,St):Ye(e)?[e]:ke(qc(ae(e)))}function wv(e){var t=++Ap;return ae(e)+t}var _v=ts(function(e,t){return e+t},0),bv=An("ceil"),Ev=ts(function(e,t){return e/t},1),Iv=An("floor");function Pv(e){return e&&e.length?Wr(e,Be,fn):i}function Sv(e,t){return e&&e.length?Wr(e,z(t,2),fn):i}function Rv(e){return wa(e,Be)}function Cv(e,t){return wa(e,z(t,2))}function xv(e){return e&&e.length?Wr(e,Be,vn):i}function Av(e,t){return e&&e.length?Wr(e,z(t,2),vn):i}var Ov=ts(function(e,t){return e*t},1),Dv=An("round"),Tv=ts(function(e,t){return e-t},0);function qv(e){return e&&e.length?tn(e,Be):0}function Nv(e,t){return e&&e.length?tn(e,z(t,2)):0}return p.after=iy,p.ary=Bc,p.assign=Hy,p.assignIn=sh,p.assignInWith=fs,p.assignWith=By,p.at=Vy,p.before=Vc,p.bind=kn,p.bindAll=Jm,p.bindKey=Kc,p.castArray=fy,p.chain=kc,p.chunk=If,p.compact=Pf,p.concat=Sf,p.cond=Ym,p.conforms=Zm,p.constant=Wn,p.countBy=qg,p.create=Ky,p.curry=Gc,p.curryRight=Wc,p.debounce=Qc,p.defaults=Gy,p.defaultsDeep=Wy,p.defer=ry,p.delay=sy,p.difference=Rf,p.differenceBy=Cf,p.differenceWith=xf,p.drop=Af,p.dropRight=Of,p.dropRightWhile=Df,p.dropWhile=Tf,p.fill=qf,p.filter=Fg,p.flatMap=Mg,p.flatMapDeep=zg,p.flatMapDepth=Lg,p.flatten=jc,p.flattenDeep=Nf,p.flattenDepth=Ff,p.flip=ny,p.flow=ev,p.flowRight=tv,p.fromPairs=$f,p.functions=tm,p.functionsIn=im,p.groupBy=kg,p.initial=Mf,p.intersection=zf,p.intersectionBy=Lf,p.intersectionWith=kf,p.invert=sm,p.invertBy=nm,p.invokeMap=Hg,p.iteratee=Qn,p.keyBy=Bg,p.keys=Ce,p.keysIn=He,p.map=cs,p.mapKeys=am,p.mapValues=cm,p.matches=iv,p.matchesProperty=rv,p.memoize=us,p.merge=hm,p.mergeWith=nh,p.method=sv,p.methodOf=nv,p.mixin=Jn,p.negate=ls,p.nthArg=av,p.omit=um,p.omitBy=lm,p.once=oy,p.orderBy=Vg,p.over=cv,p.overArgs=ay,p.overEvery=hv,p.overSome=uv,p.partial=Un,p.partialRight=Jc,p.partition=Kg,p.pick=pm,p.pickBy=oh,p.property=dh,p.propertyOf=lv,p.pull=Vf,p.pullAll=zc,p.pullAllBy=Kf,p.pullAllWith=Gf,p.pullAt=Wf,p.range=pv,p.rangeRight=dv,p.rearg=cy,p.reject=Qg,p.remove=Qf,p.rest=hy,p.reverse=zn,p.sampleSize=Yg,p.set=fm,p.setWith=gm,p.shuffle=Zg,p.slice=Jf,p.sortBy=ty,p.sortedUniq=rg,p.sortedUniqBy=sg,p.split=Mm,p.spread=uy,p.tail=ng,p.take=og,p.takeRight=ag,p.takeRightWhile=cg,p.takeWhile=hg,p.tap=Pg,p.throttle=ly,p.thru=as,p.toArray=th,p.toPairs=ah,p.toPairsIn=ch,p.toPath=vv,p.toPlainObject=rh,p.transform=ym,p.unary=py,p.union=ug,p.unionBy=lg,p.unionWith=pg,p.uniq=dg,p.uniqBy=fg,p.uniqWith=gg,p.unset=mm,p.unzip=Ln,p.unzipWith=Lc,p.update=vm,p.updateWith=wm,p.values=Ni,p.valuesIn=_m,p.without=yg,p.words=lh,p.wrap=dy,p.xor=mg,p.xorBy=vg,p.xorWith=wg,p.zip=_g,p.zipObject=bg,p.zipObjectDeep=Eg,p.zipWith=Ig,p.entries=ah,p.entriesIn=ch,p.extend=sh,p.extendWith=fs,Jn(p,p),p.add=_v,p.attempt=ph,p.camelCase=Pm,p.capitalize=hh,p.ceil=bv,p.clamp=bm,p.clone=gy,p.cloneDeep=my,p.cloneDeepWith=vy,p.cloneWith=yy,p.conformsTo=wy,p.deburr=uh,p.defaultTo=Xm,p.divide=Ev,p.endsWith=Sm,p.eq=mt,p.escape=Rm,p.escapeRegExp=Cm,p.every=Ng,p.find=$g,p.findIndex=Fc,p.findKey=Qy,p.findLast=jg,p.findLastIndex=$c,p.findLastKey=Jy,p.floor=Iv,p.forEach=Uc,p.forEachRight=Hc,p.forIn=Yy,p.forInRight=Zy,p.forOwn=Xy,p.forOwnRight=em,p.get=Vn,p.gt=_y,p.gte=by,p.has=rm,p.hasIn=Kn,p.head=Mc,p.identity=Be,p.includes=Ug,p.indexOf=jf,p.inRange=Em,p.invoke=om,p.isArguments=pi,p.isArray=B,p.isArrayBuffer=Ey,p.isArrayLike=Ue,p.isArrayLikeObject=Ee,p.isBoolean=Iy,p.isBuffer=Zt,p.isDate=Py,p.isElement=Sy,p.isEmpty=Ry,p.isEqual=Cy,p.isEqualWith=xy,p.isError=Hn,p.isFinite=Ay,p.isFunction=Nt,p.isInteger=Yc,p.isLength=ps,p.isMap=Zc,p.isMatch=Oy,p.isMatchWith=Dy,p.isNaN=Ty,p.isNative=qy,p.isNil=Fy,p.isNull=Ny,p.isNumber=Xc,p.isObject=ve,p.isObjectLike=_e,p.isPlainObject=pr,p.isRegExp=Bn,p.isSafeInteger=$y,p.isSet=eh,p.isString=ds,p.isSymbol=Ye,p.isTypedArray=qi,p.isUndefined=jy,p.isWeakMap=My,p.isWeakSet=zy,p.join=Uf,p.kebabCase=xm,p.last=ct,p.lastIndexOf=Hf,p.lowerCase=Am,p.lowerFirst=Om,p.lt=Ly,p.lte=ky,p.max=Pv,p.maxBy=Sv,p.mean=Rv,p.meanBy=Cv,p.min=xv,p.minBy=Av,p.stubArray=Zn,p.stubFalse=Xn,p.stubObject=fv,p.stubString=gv,p.stubTrue=yv,p.multiply=Ov,p.nth=Bf,p.noConflict=ov,p.noop=Yn,p.now=hs,p.pad=Dm,p.padEnd=Tm,p.padStart=qm,p.parseInt=Nm,p.random=Im,p.reduce=Gg,p.reduceRight=Wg,p.repeat=Fm,p.replace=$m,p.result=dm,p.round=Dv,p.runInContext=m,p.sample=Jg,p.size=Xg,p.snakeCase=jm,p.some=ey,p.sortedIndex=Yf,p.sortedIndexBy=Zf,p.sortedIndexOf=Xf,p.sortedLastIndex=eg,p.sortedLastIndexBy=tg,p.sortedLastIndexOf=ig,p.startCase=zm,p.startsWith=Lm,p.subtract=Tv,p.sum=qv,p.sumBy=Nv,p.template=km,p.times=mv,p.toFinite=Ft,p.toInteger=K,p.toLength=ih,p.toLower=Um,p.toNumber=ht,p.toSafeInteger=Uy,p.toString=ae,p.toUpper=Hm,p.trim=Bm,p.trimEnd=Vm,p.trimStart=Km,p.truncate=Gm,p.unescape=Wm,p.uniqueId=wv,p.upperCase=Qm,p.upperFirst=Gn,p.each=Uc,p.eachRight=Hc,p.first=Mc,Jn(p,function(){var e={};return It(p,function(t,s){he.call(p.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),p.VERSION=n,rt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),rt(["drop","take"],function(e,t){ee.prototype[e]=function(s){s=s===i?1:Re(K(s),0);var a=this.__filtered__&&!t?new ee(this):this.clone();return a.__filtered__?a.__takeCount__=qe(s,a.__takeCount__):a.__views__.push({size:qe(s,Pe),type:e+(a.__dir__<0?"Right":"")}),a},ee.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),rt(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==b||s==H;ee.prototype[e]=function(h){var d=this.clone();return d.__iteratees__.push({iteratee:z(h,3),type:s}),d.__filtered__=d.__filtered__||a,d}}),rt(["head","last"],function(e,t){var s="take"+(t?"Right":"");ee.prototype[e]=function(){return this[s](1).value()[0]}}),rt(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");ee.prototype[e]=function(){return this.__filtered__?new ee(this):this[s](1)}}),ee.prototype.compact=function(){return this.filter(Be)},ee.prototype.find=function(e){return this.filter(e).head()},ee.prototype.findLast=function(e){return this.reverse().find(e)},ee.prototype.invokeMap=Q(function(e,t){return typeof e=="function"?new ee(this):this.map(function(s){return or(s,e,t)})}),ee.prototype.reject=function(e){return this.filter(ls(z(e)))},ee.prototype.slice=function(e,t){e=K(e);var s=this;return s.__filtered__&&(e>0||t<0)?new ee(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=K(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},ee.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ee.prototype.toArray=function(){return this.take(Pe)},It(ee.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),h=p[a?"take"+(t=="last"?"Right":""):t],d=a||/^find/.test(t);h&&(p.prototype[t]=function(){var g=this.__wrapped__,y=a?[1]:arguments,v=g instanceof ee,I=y[0],S=v||B(g),R=function(J){var re=h.apply(p,Vt([J],y));return a&&O?re[0]:re};S&&s&&typeof I=="function"&&I.length!=1&&(v=S=!1);var O=this.__chain__,j=!!this.__actions__.length,L=d&&!O,G=v&&!j;if(!d&&S){g=G?g:new ee(this);var k=e.apply(g,y);return k.__actions__.push({func:as,args:[R],thisArg:i}),new nt(k,O)}return L&&G?e.apply(this,y):(k=this.thru(R),L?a?k.value()[0]:k.value():k)})}),rt(["pop","push","shift","sort","splice","unshift"],function(e){var t=qr[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var h=arguments;if(a&&!this.__chain__){var d=this.value();return t.apply(B(d)?d:[],h)}return this[s](function(g){return t.apply(B(g)?g:[],h)})}}),It(ee.prototype,function(e,t){var s=p[t];if(s){var a=s.name+"";he.call(xi,a)||(xi[a]=[]),xi[a].push({name:t,func:s})}}),xi[es(i,W).name]=[{name:"wrapper",func:i}],ee.prototype.clone=Gp,ee.prototype.reverse=Wp,ee.prototype.value=Qp,p.prototype.at=Sg,p.prototype.chain=Rg,p.prototype.commit=Cg,p.prototype.next=xg,p.prototype.plant=Og,p.prototype.reverse=Dg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Tg,p.prototype.first=p.prototype.head,Xi&&(p.prototype[Xi]=Ag),p},Si=Rp();si?((si.exports=Si)._=Si,Ws._=Si):Ae._=Si}).call(vr)})(Ro,Ro.exports);var Eb=Object.defineProperty,Ib=Object.defineProperties,Pb=Object.getOwnPropertyDescriptors,du=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,fu=(u,r,i)=>r in u?Eb(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,gs=(u,r)=>{for(var i in r||(r={}))Sb.call(r,i)&&fu(u,i,r[i]);if(du)for(var i of du(r))Rb.call(r,i)&&fu(u,i,r[i]);return u},Cb=(u,r)=>Ib(u,Pb(r));function ii(u,r,i){var n;const o=_s(u);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${bb}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function wi(u){return u.includes(":")?u.split(":")[1]:u}function Gu(u){return u.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function xb(u,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(u));if(!i.length)return[];const n=[];return i.forEach(o=>{const c=r.namespaces[o].accounts;n.push(...c)}),n}function lo(u={},r={}){const i=gu(u),n=gu(r);return Ro.exports.merge(i,n)}function gu(u){var r,i,n,o;const c={};if(!bo(u))return c;for(const[l,f]of Object.entries(u)){const w=Su(l)?[l]:f.chains,P=f.methods||[],A=f.events||[],x=f.rpcMap||{},F=wr(l);c[F]=Cb(gs(gs({},c[F]),f),{chains:io(w,(r=c[F])==null?void 0:r.chains),methods:io(P,(i=c[F])==null?void 0:i.methods),events:io(A,(n=c[F])==null?void 0:n.events),rpcMap:gs(gs({},x),(o=c[F])==null?void 0:o.rpcMap)})}return c}function Ab(u){return u.includes(":")?u.split(":")[2]:u}function yu(u){const r={};for(const[i,n]of Object.entries(u)){const o=n.methods||[],c=n.events||[],l=n.accounts||[],f=Su(i)?[i]:n.chains?n.chains:Gu(n.accounts);r[i]={chains:f,methods:o,events:c,accounts:l}}return r}function po(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):(u=u.includes(":")?u.split(":")[1]:u,isNaN(Number(u))?u:Number(u))}const Wu={},ye=u=>Wu[u],fo=(u,r)=>{Wu[u]=r};class Ob{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=wi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class Db{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||ii(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(wi(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class Tb{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=wi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class qb{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=wi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class Nb{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=wi(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class Fb{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=wi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class $b{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=wi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Lt(new ri(n,ye("disableProviderPing")))}}class jb{constructor(r){this.name="near",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||ii(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(kt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ii(r,this.namespace);return typeof n>"u"?void 0:new Lt(new ri(n,ye("disableProviderPing")))}}var Mb=Object.defineProperty,zb=Object.defineProperties,Lb=Object.getOwnPropertyDescriptors,mu=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,Ub=Object.prototype.propertyIsEnumerable,vu=(u,r,i)=>r in u?Mb(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,ys=(u,r)=>{for(var i in r||(r={}))kb.call(r,i)&&vu(u,i,r[i]);if(mu)for(var i of mu(r))Ub.call(r,i)&&vu(u,i,r[i]);return u},go=(u,r)=>zb(u,Lb(r));class $o{constructor(r){this.events=new Do,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ao(Cs({level:(r==null?void 0:r.logger)||lu})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new $o(r);return await i.initialize(),i}async request(r,i,n){const[o,c]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(o).request({request:ys({},r),chainId:`${o}:${c}`,topic:this.session.topic,expiry:n})}sendAsync(r,i,n,o){const c=new Date().getTime();this.request(r,n,o).then(l=>i(null,xs(c,l))).catch(l=>i(l,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:we("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}async authenticate(r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(r),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(r);i&&(this.uri=i,this.events.emit("display_uri",i));const o=await n();if(this.session=o.session,this.session){const c=yu(this.session.namespaces);this.namespaces=lo(this.namespaces,c),this.persist("namespaces",this.namespaces),this.onConnect()}return o}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(c=>{this.session=c;const l=yu(c.namespaces);this.namespaces=lo(this.namespaces,l),this.persist("namespaces",this.namespaces)}).catch(c=>{if(c.message!==Ku)throw c;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(Ui(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Fo.init({logger:this.providerOpts.logger||lu,relayUrl:this.providerOpts.relayUrl||vb,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>wr(i)))];fo("client",this.client),fo("events",this.events),fo("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=xb(i,this.session),o=Gu(n),c=lo(this.namespaces,this.optionalNamespaces),l=go(ys({},c[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new Db({namespace:l});break;case"solana":this.rpcProviders[i]=new Tb({namespace:l});break;case"cosmos":this.rpcProviders[i]=new qb({namespace:l});break;case"polkadot":this.rpcProviders[i]=new Ob({namespace:l});break;case"cip34":this.rpcProviders[i]=new Nb({namespace:l});break;case"elrond":this.rpcProviders[i]=new Fb({namespace:l});break;case"multiversx":this.rpcProviders[i]=new $b({namespace:l});break;case"near":this.rpcProviders[i]=new jb({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&Ui(o)&&this.events.emit("accountsChanged",o.map(Ab))}else if(n.name==="chainChanged"){const o=i.chainId,c=i.event.data,l=wr(o),f=po(o)!==po(c)?`${l}:${po(c)}`:o;this.onChainChanged(f)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,c=(n=this.client)==null?void 0:n.session.get(r);this.session=go(ys({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",go(ys({},we("USER_DISCONNECTED")),{data:r.topic}))}),this.on(kt.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(l=>wr(l)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=wr(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){if(!this.namespaces)return;const[n,o]=this.validateChain(r);o&&(i||this.getProvider(n).setDefaultChain(o),this.namespaces[n]?this.namespaces[n].defaultChain=o:this.namespaces[`${n}:${o}`]?this.namespaces[`${n}:${o}`].defaultChain=o:this.namespaces[`${n}:${o}`]={defaultChain:o},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",o))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${pu}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${pu}/${r}`)}}const Hb=$o,Bb="wc",Vb="ethereum_provider",Kb=`${Bb}@2:${Vb}:`,Gb="https://rpc.walletconnect.com/v1/",Co=["eth_sendTransaction","personal_sign"],Wb=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],xo=["chainChanged","accountsChanged"],Qb=["chainChanged","accountsChanged","message","disconnect","connect"];var Jb=Object.defineProperty,Yb=Object.defineProperties,Zb=Object.getOwnPropertyDescriptors,wu=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,eE=Object.prototype.propertyIsEnumerable,_u=(u,r,i)=>r in u?Jb(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,Mi=(u,r)=>{for(var i in r||(r={}))Xb.call(r,i)&&_u(u,i,r[i]);if(wu)for(var i of wu(r))eE.call(r,i)&&_u(u,i,r[i]);return u},yo=(u,r)=>Yb(u,Zb(r));function Is(u){return Number(u[0].split(":")[1])}function ms(u){return`0x${u.toString(16)}`}function tE(u){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:c,optionalEvents:l,rpcMap:f}=u;if(!Ui(r))throw new Error("Invalid chains");const w={chains:r,methods:n||Co,events:c||xo,rpcMap:Mi({},r.length?{[Is(r)]:f[Is(r)]}:{})},P=c==null?void 0:c.filter(q=>!xo.includes(q)),A=n==null?void 0:n.filter(q=>!Co.includes(q));if(!i&&!l&&!o&&!(P!=null&&P.length)&&!(A!=null&&A.length))return{required:r.length?w:void 0};const x=(P==null?void 0:P.length)&&(A==null?void 0:A.length)||!i,F={chains:[...new Set(x?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:Wb))],events:[...new Set(w.events.concat(l!=null&&l.length?l:Qb))],rpcMap:f};return{required:r.length?w:void 0,optional:i.length?F:void 0}}class jo{constructor(){this.events=new bt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Kb,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new jo;return await i.initialize(r),i}async request(r,i){return await this.signer.request(r,this.formatChainId(this.chainId),i)}sendAsync(r,i,n){this.signer.sendAsync(r,i,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=tE(this.rpc);try{const o=await new Promise(async(l,f)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(P=>{!P.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),f(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(yo(Mi({namespaces:Mi({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(P=>{l(P)}).catch(P=>{f(new Error(P.message))})});if(!o)return;const c=Oh(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:ms(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async authenticate(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:r==null?void 0:r.chains});try{const i=await new Promise(async(o,c)=>{var l;this.rpc.showQrModal&&((l=this.modal)==null||l.subscribeModal(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(yo(Mi({},r),{chains:this.rpc.chains})).then(f=>{o(f)}).catch(f=>{c(new Error(f.message))})}),n=i.session;if(n){const o=Oh(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:ms(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",ms(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",yo(Mi({},we("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",ms(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],c=(n=r==null?void 0:r.optionalChains)!=null?n:[],l=o.concat(c);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const f=o.length?(r==null?void 0:r.methods)||Co:[],w=o.length?(r==null?void 0:r.events)||xo:[],P=(r==null?void 0:r.optionalMethods)||[],A=(r==null?void 0:r.optionalEvents)||[],x=(r==null?void 0:r.rpcMap)||this.buildRpcMap(l,r.projectId),F=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(q=>this.formatChainId(q)),optionalChains:c.map(q=>this.formatChainId(q)),methods:f,events:w,optionalMethods:P,optionalEvents:A,rpcMap:x,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:F,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Is(this.rpc.chains):Is(this.rpc.optionalChains),this.signer=await Hb.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await $w(()=>import("./index-8dc2ed21.js").then(o=>o.i),["assets/index-8dc2ed21.js","assets/index-7f608df4.js","assets/index-ca0082dc.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Mi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&Ui(i)&&(this.rpc.chains=i.map(c=>this.formatChainId(c)),i.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),n&&Ui(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${Gb}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}catch(r){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(r),await this.disconnect().catch(i=>this.signer.logger.warn(i))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const EE=jo;export{EE as EthereumProvider,Qb as OPTIONAL_EVENTS,Wb as OPTIONAL_METHODS,xo as REQUIRED_EVENTS,Co as REQUIRED_METHODS,jo as default};
